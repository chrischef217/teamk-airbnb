<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ - Firebase</title>
    <!-- Service Worker ì™„ì „ ì°¨ë‹¨ (ìµœìš°ì„  ë¡œë“œ) -->
    <script src="js/super-block-sw.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="js/firebase-storage.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        body { 
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="mb-8">
            <div class="bg-white rounded-lg shadow-sm p-6">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-800 mb-2">
                            <i class="fas fa-database mr-3 text-blue-600"></i>
                            ë°ì´í„° ê´€ë¦¬ ë„êµ¬
                        </h1>
                        <p class="text-gray-600">Firebase ì—°ë™, ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜, ë°±ì—… ê´€ë¦¬ë¥¼ í†µí•© ì œê³µí•©ë‹ˆë‹¤.</p>
                        <p class="text-sm text-blue-600 mt-2">ğŸ“± <strong>Firebase ì—°ë™ í›„ PCì™€ ëª¨ë°”ì¼ ê°„ ì‹¤ì‹œê°„ ë™ê¸°í™”!</strong></p>
                    </div>
                    <a href="firebase-setup.html" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors inline-flex items-center">
                        <i class="fas fa-cog mr-2"></i>
                        ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •
                    </a>
                </div>
            </div>
        </div>

        <!-- ì—°ê²° ìƒíƒœ -->
        <div class="bg-white rounded-lg shadow-sm p-6 mb-8">
            <h2 class="text-xl font-bold text-gray-800 mb-4">
                <i class="fas fa-wifi mr-2 text-green-600"></i>
                Firebase ì—°ê²° ìƒíƒœ
            </h2>
            <div id="connectionStatus" class="space-y-2">
                <div class="flex items-center">
                    <span class="w-3 h-3 rounded-full bg-gray-400 mr-3" id="statusIndicator"></span>
                    <span id="statusText" class="text-gray-600">í™•ì¸ ì¤‘...</span>
                </div>
                <div id="connectionDetails" class="text-sm text-gray-500 ml-6 hidden"></div>
            </div>
        </div>

        <!-- ë°ì´í„° í˜„í™© -->
        <div class="grid md:grid-cols-2 gap-6 mb-8">
            <!-- ë¡œì»¬ ë°ì´í„° -->
            <div class="bg-white rounded-lg shadow-sm p-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">
                    <i class="fas fa-hard-drive mr-2 text-gray-600"></i>
                    ë¡œì»¬ ë°ì´í„° (localStorage)
                </h3>
                <div class="space-y-3">
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                        <span class="text-gray-700">íˆ¬ìì</span>
                        <span id="localInvestorCount" class="font-semibold text-blue-600">í™•ì¸ ì¤‘...</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                        <span class="text-gray-700">ìˆ™ì†Œ</span>
                        <span id="localAccommodationCount" class="font-semibold text-blue-600">í™•ì¸ ì¤‘...</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                        <span class="text-gray-700">ì˜ˆì•½</span>
                        <span id="localReservationCount" class="font-semibold text-blue-600">í™•ì¸ ì¤‘...</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                        <span class="text-gray-700">íšŒê³„</span>
                        <span id="localAccountingCount" class="font-semibold text-blue-600">í™•ì¸ ì¤‘...</span>
                    </div>
                </div>
            </div>

            <!-- Firebase ë°ì´í„° -->
            <div class="bg-white rounded-lg shadow-sm p-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">
                    <i class="fab fa-google mr-2 text-orange-600"></i>
                    Firebase ë°ì´í„°
                </h3>
                <div class="space-y-3">
                    <div class="flex justify-between items-center p-3 bg-orange-50 rounded">
                        <span class="text-gray-700">íˆ¬ìì</span>
                        <span id="firebaseInvestorCount" class="font-semibold text-orange-600">í™•ì¸ ì¤‘...</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-orange-50 rounded">
                        <span class="text-gray-700">ìˆ™ì†Œ</span>
                        <span id="firebaseAccommodationCount" class="font-semibold text-orange-600">í™•ì¸ ì¤‘...</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-orange-50 rounded">
                        <span class="text-gray-700">ì˜ˆì•½</span>
                        <span id="firebaseReservationCount" class="font-semibold text-orange-600">í™•ì¸ ì¤‘...</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-orange-50 rounded">
                        <span class="text-gray-700">íšŒê³„</span>
                        <span id="firebaseAccountingCount" class="font-semibold text-orange-600">í™•ì¸ ì¤‘...</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ë§ˆì´ê·¸ë ˆì´ì…˜ ì‘ì—… -->
        <div class="bg-white rounded-lg shadow-sm p-6 mb-8">
            <h2 class="text-xl font-bold text-gray-800 mb-6">
                <i class="fas fa-exchange-alt mr-2 text-blue-600"></i>
                ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜
            </h2>

            <div class="text-center space-y-4">
                <button onclick="migrateLocalToFirebase()" 
                        class="w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white px-8 py-4 rounded-lg font-medium transition-all transform hover:scale-105">
                    <i class="fas fa-upload mr-2"></i>
                    ğŸ“¤ ë¡œì»¬ â†’ Firebase ë§ˆì´ê·¸ë ˆì´ì…˜
                </button>
                
                <button onclick="migrateFirebaseToLocal()" 
                        class="w-full bg-gradient-to-r from-green-800 to-green-600 hover:from-green-900 hover:to-green-700 text-white px-8 py-4 rounded-lg font-medium transition-all transform hover:scale-105">
                    <i class="fas fa-download mr-2"></i>
                    ğŸ“¥ Firebase â†’ ë¡œì»¬ ë§ˆì´ê·¸ë ˆì´ì…˜
                </button>
                
                <button onclick="clearLocalDataOnly()" 
                        class="w-full bg-red-600 hover:bg-red-700 text-white px-8 py-4 rounded-lg font-medium transition-colors">
                    <i class="fas fa-trash-alt mr-2"></i>
                    ğŸ—‘ï¸ ë¡œì»¬ ë°ì´í„° (localStorage)ë§Œ ì‚­ì œ
                </button>
            </div>
        </div>

        <!-- ë¡œê·¸ -->
        <div class="bg-white rounded-lg shadow-sm p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-gray-800">
                    <i class="fas fa-list mr-2 text-gray-600"></i>
                    ë§ˆì´ê·¸ë ˆì´ì…˜ ë¡œê·¸
                </h2>
                <button onclick="clearLog()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-trash mr-1"></i>
                    ë¡œê·¸ ì§€ìš°ê¸°
                </button>
            </div>
            <div id="migrationLog" class="bg-gray-50 rounded-lg p-4 h-64 overflow-y-auto font-mono text-sm">
                <div class="text-gray-500">ë§ˆì´ê·¸ë ˆì´ì…˜ ë¡œê·¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</div>
            </div>
        </div>

        <!-- ë°±ì—… & ë³µì› ì„¹ì…˜ -->
        <div class="bg-white rounded-lg shadow-sm p-6 mt-8">
            <h2 class="text-xl font-bold text-gray-800 mb-6">
                <i class="fas fa-shield-alt text-green-600 mr-2"></i>
                ë°ì´í„° ë°±ì—… & ë³µì›
            </h2>

            <!-- ë°±ì—… í˜„í™© -->
            <div class="grid md:grid-cols-2 gap-6 mb-6">
                <!-- ë§ˆì§€ë§‰ ë°±ì—… ì •ë³´ -->
                <div class="bg-gray-50 rounded-lg p-4">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">
                        <i class="fas fa-history text-blue-600 mr-2"></i>
                        ë§ˆì§€ë§‰ ë°±ì—… í˜„í™©
                    </h3>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-gray-600">ë‹¤ìš´ë¡œë“œ ì¼ì‹œ:</span>
                            <span id="lastDownloadTime" class="font-medium">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">ë°±ì—… íŒŒì¼:</span>
                            <span class="font-medium text-blue-600">Teamk_ë°±ì—…_ë°ì´í„°.xlsx</span>
                        </div>
                    </div>
                </div>

                <!-- ë°ì´í„° í†µê³„ -->
                <div class="bg-gray-50 rounded-lg p-4">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">
                        <i class="fas fa-database text-green-600 mr-2"></i>
                        í˜„ì¬ ë°ì´í„° í˜„í™©
                    </h3>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-gray-600">ìˆ™ì†Œ:</span>
                            <span id="accommodationCountBackup" class="font-medium">0ê°œ</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">íšŒê³„:</span>
                            <span id="accountingCountBackup" class="font-medium">0ê°œ</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">íˆ¬ìì:</span>
                            <span id="investorCountBackup" class="font-medium">0ê°œ</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ë°±ì—… ë‹¤ìš´ë¡œë“œ -->
            <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
                <div class="flex items-start">
                    <i class="fas fa-info-circle text-green-600 mr-3 mt-1"></i>
                    <div>
                        <h4 class="font-semibold text-green-800">ë°±ì—… íŒŒì¼ ë‹¤ìš´ë¡œë“œ</h4>
                        <ul class="text-sm text-green-700 mt-2 space-y-1">
                            <li>â€¢ ëª¨ë“  í…Œì´ë¸” ë°ì´í„°ê°€ í•˜ë‚˜ì˜ ì—‘ì…€ íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œë©ë‹ˆë‹¤</li>
                            <li>â€¢ ê° í…Œì´ë¸”ì€ ë³„ë„ì˜ ì›Œí¬ì‹œíŠ¸ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤</li>
                            <li>â€¢ íŒŒì¼ëª…: Teamk_ë°±ì—…_ë°ì´í„°_YYYYMMDD_HHMMSS.xlsx</li>
                            <li>â€¢ ë‹¤ìš´ë¡œë“œ í›„ ì•ˆì „í•œ ìœ„ì¹˜ì— ë³´ê´€í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="text-center">
                <button onclick="downloadBackup()" 
                        class="bg-green-600 hover:bg-green-700 text-white px-8 py-4 rounded-lg font-medium transition-colors">
                    <i class="fas fa-download mr-2"></i>
                    ì „ì²´ ë°ì´í„° ë°±ì—… ë‹¤ìš´ë¡œë“œ
                </button>
            </div>

            <!-- ì§„í–‰ ìƒí™© í‘œì‹œ -->
            <div id="backupProgress" class="mt-4 hidden">
                <div class="flex justify-between mb-2">
                    <span class="text-sm font-medium text-gray-700">ë°±ì—… ì§„í–‰ ìƒí™©</span>
                    <span id="progressText" class="text-sm text-gray-500">0%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-3">
                    <div id="progressBar" class="bg-blue-600 h-3 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- ë°ì´í„° ë³µì› ì„¹ì…˜ -->
        <div class="bg-white rounded-lg shadow-sm p-6 mt-8">
            <h2 class="text-xl font-bold text-gray-800 mb-6">
                <i class="fas fa-upload text-orange-600 mr-2"></i>
                ë°ì´í„° ë°±ì—… ë³µì› (ì—…ë¡œë“œ)
            </h2>

            <!-- ê²½ê³  ë©”ì‹œì§€ -->
            <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
                <div class="flex items-start">
                    <i class="fas fa-exclamation-triangle text-red-600 mr-3 mt-1"></i>
                    <div>
                        <h4 class="font-semibold text-red-800">âš ï¸ ë°ì´í„° ë³µì› ì‹œ ì£¼ì˜ì‚¬í•­</h4>
                        <ul class="text-sm text-red-700 mt-2 space-y-1">
                            <li>â€¢ <strong>ê¸°ì¡´ ë°ì´í„°ê°€ ëª¨ë‘ ì‚­ì œë˜ê³  ë°±ì—… íŒŒì¼ì˜ ë°ì´í„°ë¡œ êµì²´ë©ë‹ˆë‹¤</strong></li>
                            <li>â€¢ ë³µì› ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìœ¼ë‹ˆ ì‹ ì¤‘íˆ ê²°ì •í•´ì£¼ì„¸ìš”</li>
                            <li>â€¢ ë°±ì—… íŒŒì¼ì€ ì´ ì‹œìŠ¤í…œì—ì„œ ë‹¤ìš´ë¡œë“œí•œ Excel íŒŒì¼ë§Œ ì§€ì›ë©ë‹ˆë‹¤</li>
                            <li>â€¢ ë³µì› ì „ í˜„ì¬ ë°ì´í„°ë¥¼ ë°±ì—…í•˜ì‹œê¸¸ ê¶Œì¥í•©ë‹ˆë‹¤</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- íŒŒì¼ ì—…ë¡œë“œ ì„¹ì…˜ -->
            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6">
                <div class="flex items-start">
                    <i class="fas fa-info-circle text-yellow-600 mr-3 mt-1"></i>
                    <div>
                        <h4 class="font-semibold text-yellow-800">ì§€ì› íŒŒì¼ í˜•ì‹</h4>
                        <ul class="text-sm text-yellow-700 mt-2 space-y-1">
                            <li>â€¢ Excel íŒŒì¼ (.xlsx) - ì´ ì‹œìŠ¤í…œì—ì„œ ë‹¤ìš´ë¡œë“œí•œ ë°±ì—… íŒŒì¼</li>
                            <li>â€¢ íŒŒì¼ í¬ê¸° ì œí•œ: ìµœëŒ€ 10MB</li>
                            <li>â€¢ í•„ìš”í•œ ì›Œí¬ì‹œíŠ¸: ìˆ™ì†Œê´€ë¦¬, ìˆ˜ìµê´€ë¦¬, íˆ¬ììê´€ë¦¬</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- íŒŒì¼ ì„ íƒ ë° ì—…ë¡œë“œ -->
            <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 mb-4">
                <div class="text-center">
                    <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"></i>
                    <div class="mb-4">
                        <input type="file" id="backupFileInput" accept=".xlsx,.xls" class="hidden" onchange="handleFileSelect(event)">
                        <label for="backupFileInput" class="cursor-pointer bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors inline-flex items-center">
                            <i class="fas fa-folder-open mr-2"></i>
                            ë°±ì—… íŒŒì¼ ì„ íƒ
                        </label>
                    </div>
                    <p class="text-sm text-gray-500">
                        ë˜ëŠ” íŒŒì¼ì„ ì´ ì˜ì—­ìœ¼ë¡œ ë“œë˜ê·¸í•˜ì„¸ìš”
                    </p>
                </div>
            </div>

            <!-- ì„ íƒëœ íŒŒì¼ ì •ë³´ -->
            <div id="selectedFileInfo" class="hidden bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <i class="fas fa-file-excel text-green-600 mr-3"></i>
                        <div>
                            <div id="fileName" class="font-medium text-gray-800"></div>
                            <div id="fileSize" class="text-sm text-gray-600"></div>
                        </div>
                    </div>
                    <button onclick="clearSelectedFile()" class="text-red-600 hover:text-red-800">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>

            <!-- ë³µì› ë²„íŠ¼ -->
            <div class="text-center">
                <button id="restoreButton" onclick="restoreData()" disabled 
                        class="bg-red-600 hover:bg-red-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white px-8 py-4 rounded-lg font-medium transition-colors">
                    <i class="fas fa-upload mr-2"></i>
                    ë°ì´í„° ë³µì› ì‹¤í–‰ (ê¸°ì¡´ ë°ì´í„° ì‚­ì œ í›„ ë³µì›)
                </button>
            </div>

            <!-- ë³µì› ì§„í–‰ ìƒí™© -->
            <div id="restoreProgress" class="mt-4 hidden">
                <div class="flex justify-between mb-2">
                    <span class="text-sm font-medium text-gray-700">ë³µì› ì§„í–‰ ìƒí™©</span>
                    <span id="restoreProgressText" class="text-sm text-gray-500">0%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-3">
                    <div id="restoreProgressBar" class="bg-red-600 h-3 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
                <div id="restoreStatus" class="mt-2 text-sm text-gray-600"></div>
            </div>
        </div>

        <!-- ë’¤ë¡œê°€ê¸° ë²„íŠ¼ -->
        <div class="mt-8 text-center">
            <button onclick="window.location.href='index.html'" 
                    class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                <i class="fas fa-arrow-left mr-2"></i>
                ë©”ì¸ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°
            </button>
        </div>
    </div>

    <script>
        // í˜ì´ì§€ ë¡œë“œì‹œ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', async function() {
            await checkConnectionStatus();
            await checkLocalData();
            await checkFirebaseData();
        });

        // Firebase ì—°ê²° ìƒíƒœ í™•ì¸
        async function checkConnectionStatus() {
            const statusIndicator = document.getElementById('statusIndicator');
            const statusText = document.getElementById('statusText');
            const connectionDetails = document.getElementById('connectionDetails');

            if (!firebaseStorage.isConfigured()) {
                statusText.textContent = 'âŒ Firebase ì„¤ì • í•„ìš”';
                statusIndicator.className = 'w-3 h-3 rounded-full bg-red-400 mr-3';
                connectionDetails.textContent = 'Firebase ì—°ë™ì„ ë¨¼ì € ì„¤ì •í•´ì£¼ì„¸ìš”.';
                connectionDetails.classList.remove('hidden');
                return;
            }

            statusText.textContent = 'ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘...';
            statusIndicator.className = 'w-3 h-3 rounded-full bg-yellow-400 mr-3';

            const result = await firebaseStorage.testConnection();
            
            if (result.success) {
                statusText.textContent = 'âœ… Firebase ì—°ê²°ë¨';
                statusIndicator.className = 'w-3 h-3 rounded-full bg-green-400 mr-3';
                connectionDetails.textContent = result.message;
            } else {
                statusText.textContent = 'âŒ ì—°ê²° ì‹¤íŒ¨';
                statusIndicator.className = 'w-3 h-3 rounded-full bg-red-400 mr-3';
                connectionDetails.textContent = result.error;
            }
            connectionDetails.classList.remove('hidden');
        }

        // ë¡œì»¬ ë°ì´í„° í™•ì¸
        async function checkLocalData() {
            const investorData = JSON.parse(localStorage.getItem('investorData') || '[]');
            const accommodationData = JSON.parse(localStorage.getItem('accommodationData') || '[]');
            const reservationData = JSON.parse(localStorage.getItem('reservationData') || '[]');
            const accountingData = JSON.parse(localStorage.getItem('accountingData') || '[]');

            document.getElementById('localInvestorCount').textContent = `${investorData.length}ëª…`;
            document.getElementById('localAccommodationCount').textContent = `${accommodationData.length}ê°œ`;
            document.getElementById('localReservationCount').textContent = `${reservationData.length}ê±´`;
            document.getElementById('localAccountingCount').textContent = `${accountingData.length}ê±´`;
        }

        // Firebase ë°ì´í„° í™•ì¸
        async function checkFirebaseData() {
            try {
                if (!firebaseStorage.isConfigured()) {
                    document.getElementById('firebaseInvestorCount').textContent = 'ì„¤ì • í•„ìš”';
                    document.getElementById('firebaseAccommodationCount').textContent = 'ì„¤ì • í•„ìš”';
                    document.getElementById('firebaseReservationCount').textContent = 'ì„¤ì • í•„ìš”';
                    document.getElementById('firebaseAccountingCount').textContent = 'ì„¤ì • í•„ìš”';
                    return;
                }

                const investors = await firebaseStorage.loadInvestors();
                const accommodations = await firebaseStorage.loadAccommodations();
                const reservations = await firebaseStorage.loadReservations();
                const accounting = await firebaseStorage.loadAccounting();

                document.getElementById('firebaseInvestorCount').textContent = `${investors.length}ëª…`;
                document.getElementById('firebaseAccommodationCount').textContent = `${accommodations.length}ê°œ`;
                document.getElementById('firebaseReservationCount').textContent = `${reservations.length}ê±´`;
                document.getElementById('firebaseAccountingCount').textContent = `${accounting.length}ê±´`;

            } catch (error) {
                log('Firebase ë°ì´í„° í™•ì¸ ì¤‘ ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }



        // ë¡œì»¬ â†’ Firebase ë§ˆì´ê·¸ë ˆì´ì…˜
        async function migrateLocalToFirebase() {
            // ë¹„ë°€ë²ˆí˜¸ í™•ì¸
            const password = prompt('ğŸ”’ ë³´ì•ˆ í™•ì¸\\n\\nê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
            if (password !== '881114') {
                alert('âŒ ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                log('âŒ ë¡œì»¬â†’Firebase ë§ˆì´ê·¸ë ˆì´ì…˜ ì ‘ê·¼ ê±°ë¶€: ì˜ëª»ëœ ë¹„ë°€ë²ˆí˜¸', 'error');
                return;
            }

            if (!confirm('ë¡œì»¬ ë°ì´í„°ë¥¼ Firebaseë¡œ ì—…ë¡œë“œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\\n\\nì´ ì‘ì—…ì€ ëª‡ ë¶„ì´ ì†Œìš”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\\n\\nâš ï¸ Firebaseì˜ ê¸°ì¡´ ë°ì´í„°ëŠ” ë®ì–´ì“°ê¸°ë©ë‹ˆë‹¤.')) {
                return;
            }

            log('=== ğŸ“¤ ë¡œì»¬ â†’ Firebase ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œì‘ ===', 'info');
            
            await migrateLocalInvestorsToFirebase();
            await migrateLocalAccommodationsToFirebase();
            await migrateLocalReservationsToFirebase();
            await migrateLocalAccountingToFirebase();
            
            log('=== âœ… ë¡œì»¬ â†’ Firebase ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ! ===', 'success');
            log('ë¡œì»¬ ë°ì´í„°ê°€ Firebaseë¡œ ì„±ê³µì ìœ¼ë¡œ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰', 'success');
            
            // ë°ì´í„° í˜„í™© ì—…ë°ì´íŠ¸
            await checkLocalData();
            await checkFirebaseData();
        }

        // Firebase â†’ ë¡œì»¬ ë§ˆì´ê·¸ë ˆì´ì…˜
        async function migrateFirebaseToLocal() {
            // ë¹„ë°€ë²ˆí˜¸ í™•ì¸
            const password = prompt('ğŸ”’ ë³´ì•ˆ í™•ì¸\\n\\nê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
            if (password !== '881114') {
                alert('âŒ ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                log('âŒ Firebaseâ†’ë¡œì»¬ ë§ˆì´ê·¸ë ˆì´ì…˜ ì ‘ê·¼ ê±°ë¶€: ì˜ëª»ëœ ë¹„ë°€ë²ˆí˜¸', 'error');
                return;
            }

            if (!confirm('Firebase ë°ì´í„°ë¥¼ ë¡œì»¬ë¡œ ë‹¤ìš´ë¡œë“œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\\n\\nì´ ì‘ì—…ì€ ëª‡ ë¶„ì´ ì†Œìš”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\\n\\nâš ï¸ ë¡œì»¬ì˜ ê¸°ì¡´ ë°ì´í„°ëŠ” ë®ì–´ì“°ê¸°ë©ë‹ˆë‹¤.')) {
                return;
            }

            log('=== ğŸ“¥ Firebase â†’ ë¡œì»¬ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œì‘ ===', 'info');
            
            await migrateFirebaseInvestorsToLocal();
            await migrateFirebaseAccommodationsToLocal();
            await migrateFirebaseReservationsToLocal();
            await migrateFirebaseAccountingToLocal();
            
            log('=== âœ… Firebase â†’ ë¡œì»¬ ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ! ===', 'success');
            log('Firebase ë°ì´í„°ê°€ ë¡œì»¬ë¡œ ì„±ê³µì ìœ¼ë¡œ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰', 'success');
            
            // ë°ì´í„° í˜„í™© ì—…ë°ì´íŠ¸
            await checkLocalData();
            await checkFirebaseData();
        }

        // ë¡œì»¬ â†’ Firebase ê°œë³„ ë§ˆì´ê·¸ë ˆì´ì…˜ í•¨ìˆ˜ë“¤
        async function migrateLocalInvestorsToFirebase() {
            if (!firebaseStorage.isConfigured()) {
                log('âŒ Firebase ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.', 'error');
                return;
            }

            const localData = JSON.parse(localStorage.getItem('investorData') || '[]');
            log(`ğŸ“Š ë¡œì»¬ íˆ¬ìì ë°ì´í„°: ${localData.length}ëª…`, 'info');

            if (localData.length > 0) {
                log(`ğŸ“¤ ë¡œì»¬ íˆ¬ìì â†’ Firebase: ${localData.length}ëª… ì—…ë¡œë“œ ì¤‘...`, 'info');
                for (const investor of localData) {
                    try {
                        await firebaseStorage.saveInvestor(investor);
                        log(`âœ… "${investor.name}" Firebase ì €ì¥ ì™„ë£Œ`, 'success');
                    } catch (error) {
                        log(`âŒ "${investor.name}" Firebase ì €ì¥ ì‹¤íŒ¨: ${error.message}`, 'error');
                    }
                }
            } else {
                log('ğŸ“Š ë¡œì»¬ì— íˆ¬ìì ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'warning');
            }

            log('ğŸ‰ íˆ¬ìì ë¡œì»¬â†’Firebase ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ!', 'success');
        }

        async function migrateLocalAccommodationsToFirebase() {
            if (!firebaseStorage.isConfigured()) {
                log('âŒ Firebase ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.', 'error');
                return;
            }

            const localData = JSON.parse(localStorage.getItem('accommodationData') || '[]');
            log(`ğŸ  ë¡œì»¬ ìˆ™ì†Œ ë°ì´í„°: ${localData.length}ê°œ`, 'info');

            if (localData.length > 0) {
                log(`ğŸ“¤ ë¡œì»¬ ìˆ™ì†Œ â†’ Firebase: ${localData.length}ê°œ ì—…ë¡œë“œ ì¤‘...`, 'info');
                for (const accommodation of localData) {
                    try {
                        await firebaseStorage.saveAccommodation(accommodation);
                        log(`âœ… "${accommodation.name}" Firebase ì €ì¥ ì™„ë£Œ`, 'success');
                    } catch (error) {
                        log(`âŒ "${accommodation.name}" Firebase ì €ì¥ ì‹¤íŒ¨: ${error.message}`, 'error');
                    }
                }
            } else {
                log('ğŸ  ë¡œì»¬ì— ìˆ™ì†Œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'warning');
            }

            log('ğŸ‰ ìˆ™ì†Œ ë¡œì»¬â†’Firebase ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ!', 'success');
        }

        async function migrateLocalReservationsToFirebase() {
            if (!firebaseStorage.isConfigured()) {
                log('âŒ Firebase ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.', 'error');
                return;
            }

            const localData = JSON.parse(localStorage.getItem('reservationData') || '[]');
            log(`ğŸ“… ë¡œì»¬ ì˜ˆì•½ ë°ì´í„°: ${localData.length}ê±´`, 'info');

            if (localData.length > 0) {
                log(`ğŸ“¤ ë¡œì»¬ ì˜ˆì•½ â†’ Firebase: ${localData.length}ê±´ ì—…ë¡œë“œ ì¤‘...`, 'info');
                for (const reservation of localData) {
                    try {
                        await firebaseStorage.saveReservation(reservation);
                        log(`âœ… ì˜ˆì•½ Firebase ì €ì¥ ì™„ë£Œ (ID: ${reservation.id})`, 'success');
                    } catch (error) {
                        log(`âŒ ì˜ˆì•½ Firebase ì €ì¥ ì‹¤íŒ¨: ${error.message}`, 'error');
                    }
                }
            } else {
                log('ğŸ“… ë¡œì»¬ì— ì˜ˆì•½ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'warning');
            }

            log('ğŸ‰ ì˜ˆì•½ ë¡œì»¬â†’Firebase ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ!', 'success');
        }

        async function migrateLocalAccountingToFirebase() {
            if (!firebaseStorage.isConfigured()) {
                log('âŒ Firebase ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.', 'error');
                return;
            }

            const localData = JSON.parse(localStorage.getItem('accountingData') || '[]');
            log(`ğŸ’° ë¡œì»¬ íšŒê³„ ë°ì´í„°: ${localData.length}ê±´`, 'info');

            if (localData.length > 0) {
                log(`ğŸ“¤ ë¡œì»¬ íšŒê³„ â†’ Firebase: ${localData.length}ê±´ ì—…ë¡œë“œ ì¤‘...`, 'info');
                for (const accounting of localData) {
                    try {
                        await firebaseStorage.saveAccounting(accounting);
                        log(`âœ… íšŒê³„ Firebase ì €ì¥ ì™„ë£Œ (ID: ${accounting.id})`, 'success');
                    } catch (error) {
                        log(`âŒ íšŒê³„ Firebase ì €ì¥ ì‹¤íŒ¨: ${error.message}`, 'error');
                    }
                }
            } else {
                log('ğŸ’° ë¡œì»¬ì— íšŒê³„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'warning');
            }

            log('ğŸ‰ íšŒê³„ ë¡œì»¬â†’Firebase ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ!', 'success');
        }

        // Firebase â†’ ë¡œì»¬ ê°œë³„ ë§ˆì´ê·¸ë ˆì´ì…˜ í•¨ìˆ˜ë“¤
        async function migrateFirebaseInvestorsToLocal() {
            if (!firebaseStorage.isConfigured()) {
                log('âŒ Firebase ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.', 'error');
                return;
            }

            try {
                const firebaseData = await firebaseStorage.loadInvestors();
                log(`ğŸ“Š Firebase íˆ¬ìì ë°ì´í„°: ${firebaseData.length}ëª…`, 'info');

                if (firebaseData.length > 0) {
                    log(`ğŸ“¥ Firebase íˆ¬ìì â†’ ë¡œì»¬: ${firebaseData.length}ëª… ë‹¤ìš´ë¡œë“œ ì¤‘...`, 'info');
                    localStorage.setItem('investorData', JSON.stringify(firebaseData));
                    log(`âœ… íˆ¬ìì ë°ì´í„° ë¡œì»¬ ì €ì¥ ì™„ë£Œ: ${firebaseData.length}ëª…`, 'success');
                } else {
                    log('ğŸ“Š Firebaseì— íˆ¬ìì ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                }
            } catch (error) {
                log(`âŒ Firebase íˆ¬ìì ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ${error.message}`, 'error');
            }

            log('ğŸ‰ íˆ¬ìì Firebaseâ†’ë¡œì»¬ ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ!', 'success');
        }

        async function migrateFirebaseAccommodationsToLocal() {
            if (!firebaseStorage.isConfigured()) {
                log('âŒ Firebase ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.', 'error');
                return;
            }

            try {
                const firebaseData = await firebaseStorage.loadAccommodations();
                log(`ğŸ  Firebase ìˆ™ì†Œ ë°ì´í„°: ${firebaseData.length}ê°œ`, 'info');

                if (firebaseData.length > 0) {
                    log(`ğŸ“¥ Firebase ìˆ™ì†Œ â†’ ë¡œì»¬: ${firebaseData.length}ê°œ ë‹¤ìš´ë¡œë“œ ì¤‘...`, 'info');
                    localStorage.setItem('accommodationData', JSON.stringify(firebaseData));
                    log(`âœ… ìˆ™ì†Œ ë°ì´í„° ë¡œì»¬ ì €ì¥ ì™„ë£Œ: ${firebaseData.length}ê°œ`, 'success');
                } else {
                    log('ğŸ  Firebaseì— ìˆ™ì†Œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                }
            } catch (error) {
                log(`âŒ Firebase ìˆ™ì†Œ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ${error.message}`, 'error');
            }

            log('ğŸ‰ ìˆ™ì†Œ Firebaseâ†’ë¡œì»¬ ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ!', 'success');
        }

        async function migrateFirebaseReservationsToLocal() {
            if (!firebaseStorage.isConfigured()) {
                log('âŒ Firebase ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.', 'error');
                return;
            }

            try {
                const firebaseData = await firebaseStorage.loadReservations();
                log(`ğŸ“… Firebase ì˜ˆì•½ ë°ì´í„°: ${firebaseData.length}ê±´`, 'info');

                if (firebaseData.length > 0) {
                    log(`ğŸ“¥ Firebase ì˜ˆì•½ â†’ ë¡œì»¬: ${firebaseData.length}ê±´ ë‹¤ìš´ë¡œë“œ ì¤‘...`, 'info');
                    localStorage.setItem('reservationData', JSON.stringify(firebaseData));
                    log(`âœ… ì˜ˆì•½ ë°ì´í„° ë¡œì»¬ ì €ì¥ ì™„ë£Œ: ${firebaseData.length}ê±´`, 'success');
                } else {
                    log('ğŸ“… Firebaseì— ì˜ˆì•½ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                }
            } catch (error) {
                log(`âŒ Firebase ì˜ˆì•½ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ${error.message}`, 'error');
            }

            log('ğŸ‰ ì˜ˆì•½ Firebaseâ†’ë¡œì»¬ ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ!', 'success');
        }

        async function migrateFirebaseAccountingToLocal() {
            if (!firebaseStorage.isConfigured()) {
                log('âŒ Firebase ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.', 'error');
                return;
            }

            try {
                const firebaseData = await firebaseStorage.loadAccounting();
                log(`ğŸ’° Firebase íšŒê³„ ë°ì´í„°: ${firebaseData.length}ê±´`, 'info');

                if (firebaseData.length > 0) {
                    log(`ğŸ“¥ Firebase íšŒê³„ â†’ ë¡œì»¬: ${firebaseData.length}ê±´ ë‹¤ìš´ë¡œë“œ ì¤‘...`, 'info');
                    localStorage.setItem('accountingData', JSON.stringify(firebaseData));
                    log(`âœ… íšŒê³„ ë°ì´í„° ë¡œì»¬ ì €ì¥ ì™„ë£Œ: ${firebaseData.length}ê±´`, 'success');
                } else {
                    log('ğŸ’° Firebaseì— íšŒê³„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                }
            } catch (error) {
                log(`âŒ Firebase íšŒê³„ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ${error.message}`, 'error');
            }

            log('ğŸ‰ íšŒê³„ Firebaseâ†’ë¡œì»¬ ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ!', 'success');
        }

        // ë¡œì»¬ ë°ì´í„°ë§Œ ì‚­ì œ
        async function clearLocalDataOnly() {
            // ë¹„ë°€ë²ˆí˜¸ í™•ì¸
            const password = prompt('ğŸ”’ ë³´ì•ˆ í™•ì¸\\n\\nê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
            if (password !== '881114') {
                alert('âŒ ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                log('âŒ ë¡œì»¬ ë°ì´í„° ì‚­ì œ ì ‘ê·¼ ê±°ë¶€: ì˜ëª»ëœ ë¹„ë°€ë²ˆí˜¸', 'error');
                return;
            }

            const confirmMessage = 'âš ï¸ ê²½ê³ !\\n\\në¡œì»¬ ì €ì¥ì†Œ(localStorage)ì˜ ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤.\\n\\nì‚­ì œë  ë°ì´í„°:\\nâ€¢ íˆ¬ìì ë°ì´í„°\\nâ€¢ ìˆ™ì†Œ ë°ì´í„°\\nâ€¢ ì˜ˆì•½ ë°ì´í„°\\nâ€¢ íšŒê³„ ë°ì´í„°\\n\\nFirebase ë°ì´í„°ëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€ë©ë‹ˆë‹¤.\\n\\nì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?';
            
            if (!confirm(confirmMessage)) {
                return;
            }

            // í•œ ë²ˆ ë” í™•ì¸
            if (!confirm('ì •ë§ í™•ì‹¤í•˜ì‹ ê°€ìš”? ë¡œì»¬ ë°ì´í„°ëŠ” ì™„ì „íˆ ì‚­ì œë©ë‹ˆë‹¤!')) {
                return;
            }

            log('=== ğŸ—‘ï¸ ë¡œì»¬ ë°ì´í„° ì‚­ì œ ì‹œì‘ ===', 'warning');

            try {
                // ì‚­ì œ ì „ í˜„ì¬ ë°ì´í„° ê°œìˆ˜ í™•ì¸
                const investorData = JSON.parse(localStorage.getItem('investorData') || '[]');
                const accommodationData = JSON.parse(localStorage.getItem('accommodationData') || '[]');
                const reservationData = JSON.parse(localStorage.getItem('reservationData') || '[]');
                const accountingData = JSON.parse(localStorage.getItem('accountingData') || '[]');

                log(`ğŸ“Š ì‚­ì œ ì˜ˆì •: íˆ¬ìì ${investorData.length}ëª…, ìˆ™ì†Œ ${accommodationData.length}ê°œ, ì˜ˆì•½ ${reservationData.length}ê±´, íšŒê³„ ${accountingData.length}ê±´`, 'info');

                // ê¸´ê¸‰ ë°±ì—… ìƒì„±
                const emergencyBackup = {
                    investorData: investorData,
                    accommodationData: accommodationData,
                    reservationData: reservationData,
                    accountingData: accountingData,
                    timestamp: new Date().toISOString(),
                    reason: 'manual_local_data_clear'
                };
                localStorage.setItem('emergency_backup_manual_clear', JSON.stringify(emergencyBackup));
                log('ğŸ”’ ê¸´ê¸‰ ë°±ì—… ìƒì„± ì™„ë£Œ', 'info');

                // ë¡œì»¬ ë°ì´í„° ì‚­ì œ
                localStorage.removeItem('investorData');
                log('âœ… íˆ¬ìì ë°ì´í„° ì‚­ì œ ì™„ë£Œ', 'success');

                localStorage.removeItem('accommodationData');
                log('âœ… ìˆ™ì†Œ ë°ì´í„° ì‚­ì œ ì™„ë£Œ', 'success');

                localStorage.removeItem('reservationData');
                log('âœ… ì˜ˆì•½ ë°ì´í„° ì‚­ì œ ì™„ë£Œ', 'success');

                localStorage.removeItem('accountingData');
                log('âœ… íšŒê³„ ë°ì´í„° ì‚­ì œ ì™„ë£Œ', 'success');

                // í™”ë©´ ì—…ë°ì´íŠ¸
                await checkLocalData();

                log('=== âœ… ë¡œì»¬ ë°ì´í„° ì‚­ì œ ì™„ë£Œ! ===', 'success');
                log('ğŸ’¡ Firebase ë°ì´í„°ëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€ë©ë‹ˆë‹¤.', 'info');
                log('ğŸ”„ Firebaseì—ì„œ ë°ì´í„°ë¥¼ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ë ¤ë©´ ê° í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì„¸ìš”.', 'info');

                // ì„±ê³µ ì•Œë¦¼
                alert('âœ… ë¡œì»¬ ë°ì´í„° ì‚­ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\\n\\nFirebase ë°ì´í„°ëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€ë©ë‹ˆë‹¤.\\nê° í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ë©´ Firebaseì—ì„œ ë°ì´í„°ê°€ ë‹¤ì‹œ ë¡œë“œë©ë‹ˆë‹¤.');

            } catch (error) {
                log('âŒ ë¡œì»¬ ë°ì´í„° ì‚­ì œ ì¤‘ ì˜¤ë¥˜: ' + error.message, 'error');
                console.error('ë¡œì»¬ ë°ì´í„° ì‚­ì œ ì˜¤ë¥˜:', error);
            }
        }

        // ë¡œê·¸ ì¶œë ¥
        function log(message, type = 'info') {
            const logContainer = document.getElementById('migrationLog');
            const timestamp = new Date().toLocaleTimeString();
            
            const colors = {
                success: 'text-green-600',
                error: 'text-red-600',
                warning: 'text-yellow-600',
                info: 'text-blue-600'
            };

            const logEntry = document.createElement('div');
            logEntry.className = `${colors[type]} mb-1`;
            logEntry.textContent = `[${timestamp}] ${message}`;
            
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // ë¡œê·¸ ì§€ìš°ê¸°
        function clearLog() {
            document.getElementById('migrationLog').innerHTML = '<div class="text-gray-500">ë§ˆì´ê·¸ë ˆì´ì…˜ ë¡œê·¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</div>';
        }

        // ë°±ì—… ê¸°ëŠ¥ë“¤
        function updateDataCounts() {
            try {
                const accommodations = JSON.parse(localStorage.getItem('accommodationData') || '[]');
                const accounting = JSON.parse(localStorage.getItem('accountingData') || '[]');
                const investors = JSON.parse(localStorage.getItem('investorData') || '[]');

                document.getElementById('accommodationCountBackup').textContent = accommodations.length + 'ê°œ';
                document.getElementById('accountingCountBackup').textContent = accounting.length + 'ê°œ';
                document.getElementById('investorCountBackup').textContent = investors.length + 'ê°œ';
            } catch (error) {
                console.error('ë°ì´í„° ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
            }
        }

        function downloadBackup() {
            // ë¹„ë°€ë²ˆí˜¸ í™•ì¸
            const password = prompt('ğŸ”’ ë³´ì•ˆ í™•ì¸\\n\\nê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
            if (password !== '881114') {
                alert('âŒ ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                log('âŒ ì „ì²´ ë°ì´í„° ë°±ì—… ë‹¤ìš´ë¡œë“œ ì ‘ê·¼ ê±°ë¶€: ì˜ëª»ëœ ë¹„ë°€ë²ˆí˜¸', 'error');
                return;
            }

            const progress = document.getElementById('backupProgress');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            
            progress.classList.remove('hidden');
            
            try {
                // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸ í•¨ìˆ˜
                function updateProgress(percentage) {
                    progressBar.style.width = `${percentage}%`;
                    progressText.textContent = `${Math.round(percentage)}%`;
                }

                updateProgress(10);
                
                // localStorageì—ì„œ ë°ì´í„° ë¡œë“œ
                const accommodations = JSON.parse(localStorage.getItem('accommodationData') || '[]');
                const accounting = JSON.parse(localStorage.getItem('accountingData') || '[]');
                const investors = JSON.parse(localStorage.getItem('investorData') || '[]');
                
                updateProgress(30);

                // ì›Œí¬ë¶ ìƒì„±
                const wb = XLSX.utils.book_new();

                // ìˆ™ì†Œ ë°ì´í„° ì‹œíŠ¸
                if (accommodations.length > 0) {
                    const ws_accommodations = XLSX.utils.json_to_sheet(accommodations);
                    XLSX.utils.book_append_sheet(wb, ws_accommodations, "ìˆ™ì†Œê´€ë¦¬");
                }
                
                updateProgress(50);

                // íšŒê³„ ë°ì´í„° ì‹œíŠ¸
                if (accounting.length > 0) {
                    const ws_accounting = XLSX.utils.json_to_sheet(accounting);
                    XLSX.utils.book_append_sheet(wb, ws_accounting, "ìˆ˜ìµê´€ë¦¬");
                }
                
                updateProgress(70);

                // íˆ¬ìì ë°ì´í„° ì‹œíŠ¸
                if (investors.length > 0) {
                    const ws_investors = XLSX.utils.json_to_sheet(investors);
                    XLSX.utils.book_append_sheet(wb, ws_investors, "íˆ¬ììê´€ë¦¬");
                }

                updateProgress(90);

                // íŒŒì¼ëª… ìƒì„±
                const now = new Date();
                const timestamp = now.toISOString().replace(/[:.]/g, '').slice(0, -5);
                const filename = `Teamk_ë°±ì—…_ë°ì´í„°_${timestamp}.xlsx`;

                // íŒŒì¼ ë‹¤ìš´ë¡œë“œ
                XLSX.writeFile(wb, filename);
                
                updateProgress(100);

                // ë§ˆì§€ë§‰ ë‹¤ìš´ë¡œë“œ ì‹œê°„ ì—…ë°ì´íŠ¸
                document.getElementById('lastDownloadTime').textContent = now.toLocaleString();
                
                // ì„±ê³µ ë©”ì‹œì§€
                setTimeout(() => {
                    progress.classList.add('hidden');
                    log('âœ… ë°±ì—… íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ: ' + filename, 'success');
                    updateProgress(0);
                }, 1000);

            } catch (error) {
                console.error('ë°±ì—… ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨:', error);
                log('âŒ ë°±ì—… ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨: ' + error.message, 'error');
                progress.classList.add('hidden');
                updateProgress(0);
            }
        }

        // íŒŒì¼ ì„ íƒ ì²˜ë¦¬
        let selectedFile = null;

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;

            // íŒŒì¼ í˜•ì‹ ì²´í¬
            if (!file.name.toLowerCase().endsWith('.xlsx') && !file.name.toLowerCase().endsWith('.xls')) {
                alert('Excel íŒŒì¼(.xlsx, .xls)ë§Œ ì§€ì›ë©ë‹ˆë‹¤.');
                return;
            }

            // íŒŒì¼ í¬ê¸° ì²´í¬ (10MB)
            if (file.size > 10 * 1024 * 1024) {
                alert('íŒŒì¼ í¬ê¸°ëŠ” 10MB ì´í•˜ë§Œ ì§€ì›ë©ë‹ˆë‹¤.');
                return;
            }

            selectedFile = file;
            showSelectedFileInfo(file);
        }

        function showSelectedFileInfo(file) {
            const fileInfo = document.getElementById('selectedFileInfo');
            const fileName = document.getElementById('fileName');
            const fileSize = document.getElementById('fileSize');
            const restoreButton = document.getElementById('restoreButton');

            fileName.textContent = file.name;
            fileSize.textContent = `í¬ê¸°: ${(file.size / 1024 / 1024).toFixed(2)} MB`;
            
            fileInfo.classList.remove('hidden');
            restoreButton.disabled = false;
            restoreButton.classList.remove('disabled:bg-gray-400', 'disabled:cursor-not-allowed');
        }

        function clearSelectedFile() {
            selectedFile = null;
            document.getElementById('backupFileInput').value = '';
            document.getElementById('selectedFileInfo').classList.add('hidden');
            
            const restoreButton = document.getElementById('restoreButton');
            restoreButton.disabled = true;
            restoreButton.classList.add('disabled:bg-gray-400', 'disabled:cursor-not-allowed');
        }

        // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì§€ì›
        document.addEventListener('DOMContentLoaded', function() {
            const dropZone = document.querySelector('.border-dashed');
            
            dropZone.addEventListener('dragover', function(e) {
                e.preventDefault();
                dropZone.classList.add('border-blue-400', 'bg-blue-50');
            });

            dropZone.addEventListener('dragleave', function(e) {
                e.preventDefault();
                dropZone.classList.remove('border-blue-400', 'bg-blue-50');
            });

            dropZone.addEventListener('drop', function(e) {
                e.preventDefault();
                dropZone.classList.remove('border-blue-400', 'bg-blue-50');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    document.getElementById('backupFileInput').files = files;
                    handleFileSelect({ target: { files: files } });
                }
            });
        });

        // ë°ì´í„° ë³µì› í•¨ìˆ˜
        async function restoreData() {
            if (!selectedFile) {
                alert('ë³µì›í•  íŒŒì¼ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            // ë¹„ë°€ë²ˆí˜¸ í™•ì¸
            const password = prompt('ğŸ”’ ë³´ì•ˆ í™•ì¸\\n\\nê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
            if (password !== '881114') {
                alert('âŒ ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                log('âŒ ë°ì´í„° ë³µì› ì ‘ê·¼ ê±°ë¶€: ì˜ëª»ëœ ë¹„ë°€ë²ˆí˜¸', 'error');
                return;
            }

            // ìµœì¢… í™•ì¸
            const confirmMessage = `âš ï¸ ê²½ê³ !\n\ní˜„ì¬ ì €ì¥ëœ ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë˜ê³ , ì„ íƒí•œ ë°±ì—… íŒŒì¼ì˜ ë°ì´í„°ë¡œ êµì²´ë©ë‹ˆë‹¤.\n\níŒŒì¼ëª…: ${selectedFile.name}\n\nì •ë§ë¡œ ë³µì›í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!`;
            
            if (!confirm(confirmMessage)) {
                return;
            }

            // í•œ ë²ˆ ë” í™•ì¸
            if (!confirm('ì •ë§ í™•ì‹¤í•˜ì‹ ê°€ìš”? ê¸°ì¡´ ë°ì´í„°ëŠ” ì™„ì „íˆ ì‚¬ë¼ì§‘ë‹ˆë‹¤!')) {
                return;
            }

            const progress = document.getElementById('restoreProgress');
            const progressBar = document.getElementById('restoreProgressBar');
            const progressText = document.getElementById('restoreProgressText');
            const statusText = document.getElementById('restoreStatus');
            const restoreButton = document.getElementById('restoreButton');

            // UI ì—…ë°ì´íŠ¸
            progress.classList.remove('hidden');
            restoreButton.disabled = true;

            try {
                // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸ í•¨ìˆ˜
                function updateRestoreProgress(percentage, status) {
                    progressBar.style.width = `${percentage}%`;
                    progressText.textContent = `${Math.round(percentage)}%`;
                    statusText.textContent = status;
                }

                updateRestoreProgress(10, 'íŒŒì¼ ì½ê¸° ì¤‘...');
                
                // íŒŒì¼ ì½ê¸°
                const data = await readExcelFile(selectedFile);
                updateRestoreProgress(30, 'ë°ì´í„° íŒŒì‹± ì¤‘...');

                // ê¸°ì¡´ ë°ì´í„° ë°±ì—… (í˜¹ì‹œ ëª¨ë¥¼ ë³µêµ¬ë¥¼ ìœ„í•´)
                const backupData = {
                    accommodations: JSON.parse(localStorage.getItem('accommodationData') || '[]'),
                    accounting: JSON.parse(localStorage.getItem('accountingData') || '[]'),
                    investors: JSON.parse(localStorage.getItem('investorData') || '[]'),
                    timestamp: new Date().toISOString()
                };
                localStorage.setItem('emergency_backup_before_restore', JSON.stringify(backupData));
                
                updateRestoreProgress(50, 'ê¸°ì¡´ ë°ì´í„° ì‚­ì œ ì¤‘...');

                // ê¸°ì¡´ ë°ì´í„° ì‚­ì œ
                localStorage.removeItem('accommodationData');
                localStorage.removeItem('accountingData');
                localStorage.removeItem('investorData');

                updateRestoreProgress(70, 'ìƒˆ ë°ì´í„° ë³µì› ì¤‘...');

                // ìƒˆ ë°ì´í„° ì €ì¥
                if (data.accommodations && data.accommodations.length > 0) {
                    localStorage.setItem('accommodationData', JSON.stringify(data.accommodations));
                }
                if (data.accounting && data.accounting.length > 0) {
                    localStorage.setItem('accountingData', JSON.stringify(data.accounting));
                }
                if (data.investors && data.investors.length > 0) {
                    localStorage.setItem('investorData', JSON.stringify(data.investors));
                }

                updateRestoreProgress(90, 'ë°ì´í„° ê²€ì¦ ì¤‘...');

                // ë³µì›ëœ ë°ì´í„° ê²€ì¦
                const restoredAccommodations = JSON.parse(localStorage.getItem('accommodationData') || '[]');
                const restoredAccounting = JSON.parse(localStorage.getItem('accountingData') || '[]');
                const restoredInvestors = JSON.parse(localStorage.getItem('investorData') || '[]');

                updateRestoreProgress(100, 'ë³µì› ì™„ë£Œ!');

                // ì„±ê³µ ë©”ì‹œì§€
                const successMessage = `âœ… ë°ì´í„° ë³µì›ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\n\në³µì›ëœ ë°ì´í„°:\nâ€¢ ìˆ™ì†Œ: ${restoredAccommodations.length}ê°œ\nâ€¢ íšŒê³„: ${restoredAccounting.length}ê±´\nâ€¢ íˆ¬ìì: ${restoredInvestors.length}ëª…\n\ní˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ í™•ì¸í•´ë³´ì„¸ìš”.`;
                alert(successMessage);

                log('âœ… ë°ì´í„° ë³µì› ì™„ë£Œ: ' + selectedFile.name, 'success');
                log(`ğŸ“Š ë³µì›ëœ ë°ì´í„°: ìˆ™ì†Œ ${restoredAccommodations.length}ê°œ, íšŒê³„ ${restoredAccounting.length}ê±´, íˆ¬ìì ${restoredInvestors.length}ëª…`, 'success');

                // ë°ì´í„° ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
                updateDataCounts();

                // UI ì´ˆê¸°í™”
                clearSelectedFile();

                // 2ì´ˆ í›„ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                setTimeout(() => {
                    window.location.reload();
                }, 2000);

            } catch (error) {
                console.error('ë°ì´í„° ë³µì› ì‹¤íŒ¨:', error);
                log('âŒ ë°ì´í„° ë³µì› ì‹¤íŒ¨: ' + error.message, 'error');
                alert('ë°ì´í„° ë³µì› ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                
                // ê¸´ê¸‰ ë³µêµ¬ ì‹œë„ (ê¸°ì¡´ ë°ì´í„° ë³µì›)
                try {
                    const emergencyBackup = localStorage.getItem('emergency_backup_before_restore');
                    if (emergencyBackup) {
                        const backupData = JSON.parse(emergencyBackup);
                        if (backupData.accommodations) localStorage.setItem('accommodationData', JSON.stringify(backupData.accommodations));
                        if (backupData.accounting) localStorage.setItem('accountingData', JSON.stringify(backupData.accounting));
                        if (backupData.investors) localStorage.setItem('investorData', JSON.stringify(backupData.investors));
                        log('ğŸ”„ ê¸°ì¡´ ë°ì´í„°ë¡œ ê¸´ê¸‰ ë³µêµ¬ ì™„ë£Œ', 'warning');
                    }
                } catch (recoveryError) {
                    console.error('ê¸´ê¸‰ ë³µêµ¬ ì‹¤íŒ¨:', recoveryError);
                }
            } finally {
                progress.classList.add('hidden');
                restoreButton.disabled = false;
                updateRestoreProgress(0, '');
            }
        }

        // Excel íŒŒì¼ ì½ê¸° í•¨ìˆ˜
        function readExcelFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });

                        const result = {};

                        // ìˆ™ì†Œê´€ë¦¬ ì‹œíŠ¸
                        if (workbook.SheetNames.includes('ìˆ™ì†Œê´€ë¦¬')) {
                            const accommodationSheet = workbook.Sheets['ìˆ™ì†Œê´€ë¦¬'];
                            result.accommodations = XLSX.utils.sheet_to_json(accommodationSheet);
                        }

                        // ìˆ˜ìµê´€ë¦¬ ì‹œíŠ¸
                        if (workbook.SheetNames.includes('ìˆ˜ìµê´€ë¦¬')) {
                            const accountingSheet = workbook.Sheets['ìˆ˜ìµê´€ë¦¬'];
                            result.accounting = XLSX.utils.sheet_to_json(accountingSheet);
                        }

                        // íˆ¬ììê´€ë¦¬ ì‹œíŠ¸
                        if (workbook.SheetNames.includes('íˆ¬ììê´€ë¦¬')) {
                            const investorSheet = workbook.Sheets['íˆ¬ììê´€ë¦¬'];
                            result.investors = XLSX.utils.sheet_to_json(investorSheet);
                        }

                        resolve(result);
                    } catch (error) {
                        reject(new Error('Excel íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message));
                    }
                };
                reader.onerror = function() {
                    reject(new Error('íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'));
                };
                reader.readAsArrayBuffer(file);
            });
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë°ì´í„° ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
        document.addEventListener('DOMContentLoaded', function() {
            updateDataCounts();
            
            // ì£¼ê¸°ì ìœ¼ë¡œ ë°ì´í„° ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
            setInterval(updateDataCounts, 5000);
        });
    </script>
</body>
</html>