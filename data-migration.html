<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ - Firebase</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="js/firebase-storage.js"></script>
    <style>
        body { 
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="mb-8">
            <div class="bg-white rounded-lg shadow-sm p-6">
                <h1 class="text-3xl font-bold text-gray-800 mb-2">
                    <i class="fas fa-database mr-3 text-blue-600"></i>
                    ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ë„êµ¬
                </h1>
                <p class="text-gray-600">localStorageì— ì €ì¥ëœ ê¸°ì¡´ ë°ì´í„°ë¥¼ Firebaseë¡œ ì´ì „í•©ë‹ˆë‹¤.</p>
                <p class="text-sm text-blue-600 mt-2">ğŸ“± <strong>Firebase ì—°ë™ í›„ PCì™€ ëª¨ë°”ì¼ ê°„ ì‹¤ì‹œê°„ ë™ê¸°í™”!</strong></p>
            </div>
        </div>

        <!-- ì—°ê²° ìƒíƒœ -->
        <div class="bg-white rounded-lg shadow-sm p-6 mb-8">
            <h2 class="text-xl font-bold text-gray-800 mb-4">
                <i class="fas fa-wifi mr-2 text-green-600"></i>
                Firebase ì—°ê²° ìƒíƒœ
            </h2>
            <div id="connectionStatus" class="space-y-2">
                <div class="flex items-center">
                    <span class="w-3 h-3 rounded-full bg-gray-400 mr-3" id="statusIndicator"></span>
                    <span id="statusText" class="text-gray-600">í™•ì¸ ì¤‘...</span>
                </div>
                <div id="connectionDetails" class="text-sm text-gray-500 ml-6 hidden"></div>
            </div>
        </div>

        <!-- ë°ì´í„° í˜„í™© -->
        <div class="grid md:grid-cols-2 gap-6 mb-8">
            <!-- ë¡œì»¬ ë°ì´í„° -->
            <div class="bg-white rounded-lg shadow-sm p-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">
                    <i class="fas fa-hard-drive mr-2 text-gray-600"></i>
                    ë¡œì»¬ ë°ì´í„° (localStorage)
                </h3>
                <div class="space-y-3">
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                        <span class="text-gray-700">íˆ¬ìì</span>
                        <span id="localInvestorCount" class="font-semibold text-blue-600">í™•ì¸ ì¤‘...</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                        <span class="text-gray-700">ìˆ™ì†Œ</span>
                        <span id="localAccommodationCount" class="font-semibold text-blue-600">í™•ì¸ ì¤‘...</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                        <span class="text-gray-700">ì˜ˆì•½</span>
                        <span id="localReservationCount" class="font-semibold text-blue-600">í™•ì¸ ì¤‘...</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                        <span class="text-gray-700">íšŒê³„</span>
                        <span id="localAccountingCount" class="font-semibold text-blue-600">í™•ì¸ ì¤‘...</span>
                    </div>
                </div>
            </div>

            <!-- Firebase ë°ì´í„° -->
            <div class="bg-white rounded-lg shadow-sm p-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">
                    <i class="fab fa-google mr-2 text-orange-600"></i>
                    Firebase ë°ì´í„°
                </h3>
                <div class="space-y-3">
                    <div class="flex justify-between items-center p-3 bg-orange-50 rounded">
                        <span class="text-gray-700">íˆ¬ìì</span>
                        <span id="firebaseInvestorCount" class="font-semibold text-orange-600">í™•ì¸ ì¤‘...</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-orange-50 rounded">
                        <span class="text-gray-700">ìˆ™ì†Œ</span>
                        <span id="firebaseAccommodationCount" class="font-semibold text-orange-600">í™•ì¸ ì¤‘...</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-orange-50 rounded">
                        <span class="text-gray-700">ì˜ˆì•½</span>
                        <span id="firebaseReservationCount" class="font-semibold text-orange-600">í™•ì¸ ì¤‘...</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-orange-50 rounded">
                        <span class="text-gray-700">íšŒê³„</span>
                        <span id="firebaseAccountingCount" class="font-semibold text-orange-600">í™•ì¸ ì¤‘...</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ë§ˆì´ê·¸ë ˆì´ì…˜ ì‘ì—… -->
        <div class="bg-white rounded-lg shadow-sm p-6 mb-8">
            <h2 class="text-xl font-bold text-gray-800 mb-6">
                <i class="fas fa-exchange-alt mr-2 text-blue-600"></i>
                ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜
            </h2>

            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4">
                <button onclick="migrateInvestors()" 
                        class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                    <i class="fas fa-users mr-2"></i>
                    íˆ¬ìì ë§ˆì´ê·¸ë ˆì´ì…˜
                </button>

                <button onclick="migrateAccommodations()" 
                        class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                    <i class="fas fa-home mr-2"></i>
                    ìˆ™ì†Œ ë§ˆì´ê·¸ë ˆì´ì…˜
                </button>

                <button onclick="migrateReservations()" 
                        class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                    <i class="fas fa-calendar-check mr-2"></i>
                    ì˜ˆì•½ ë§ˆì´ê·¸ë ˆì´ì…˜
                </button>

                <button onclick="migrateAccounting()" 
                        class="bg-yellow-600 hover:bg-yellow-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                    <i class="fas fa-coins mr-2"></i>
                    íšŒê³„ ë§ˆì´ê·¸ë ˆì´ì…˜
                </button>
            </div>

            <div class="mt-6 pt-4 border-t">
                <button onclick="migrateAll()" 
                        class="w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white px-8 py-4 rounded-lg font-medium transition-all transform hover:scale-105">
                    <i class="fas fa-rocket mr-2"></i>
                    ğŸš€ ì „ì²´ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜
                </button>
            </div>
        </div>

        <!-- ë¡œê·¸ -->
        <div class="bg-white rounded-lg shadow-sm p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-gray-800">
                    <i class="fas fa-list mr-2 text-gray-600"></i>
                    ë§ˆì´ê·¸ë ˆì´ì…˜ ë¡œê·¸
                </h2>
                <button onclick="clearLog()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-trash mr-1"></i>
                    ë¡œê·¸ ì§€ìš°ê¸°
                </button>
            </div>
            <div id="migrationLog" class="bg-gray-50 rounded-lg p-4 h-64 overflow-y-auto font-mono text-sm">
                <div class="text-gray-500">ë§ˆì´ê·¸ë ˆì´ì…˜ ë¡œê·¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</div>
            </div>
        </div>

        <!-- ë’¤ë¡œê°€ê¸° ë²„íŠ¼ -->
        <div class="mt-8 text-center">
            <button onclick="window.location.href='index.html'" 
                    class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                <i class="fas fa-arrow-left mr-2"></i>
                ë©”ì¸ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°
            </button>
        </div>
    </div>

    <script>
        // í˜ì´ì§€ ë¡œë“œì‹œ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', async function() {
            await checkConnectionStatus();
            await checkLocalData();
            await checkFirebaseData();
        });

        // Firebase ì—°ê²° ìƒíƒœ í™•ì¸
        async function checkConnectionStatus() {
            const statusIndicator = document.getElementById('statusIndicator');
            const statusText = document.getElementById('statusText');
            const connectionDetails = document.getElementById('connectionDetails');

            if (!firebaseStorage.isConfigured()) {
                statusText.textContent = 'âŒ Firebase ì„¤ì • í•„ìš”';
                statusIndicator.className = 'w-3 h-3 rounded-full bg-red-400 mr-3';
                connectionDetails.textContent = 'Firebase ì—°ë™ì„ ë¨¼ì € ì„¤ì •í•´ì£¼ì„¸ìš”.';
                connectionDetails.classList.remove('hidden');
                return;
            }

            statusText.textContent = 'ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘...';
            statusIndicator.className = 'w-3 h-3 rounded-full bg-yellow-400 mr-3';

            const result = await firebaseStorage.testConnection();
            
            if (result.success) {
                statusText.textContent = 'âœ… Firebase ì—°ê²°ë¨';
                statusIndicator.className = 'w-3 h-3 rounded-full bg-green-400 mr-3';
                connectionDetails.textContent = result.message;
            } else {
                statusText.textContent = 'âŒ ì—°ê²° ì‹¤íŒ¨';
                statusIndicator.className = 'w-3 h-3 rounded-full bg-red-400 mr-3';
                connectionDetails.textContent = result.error;
            }
            connectionDetails.classList.remove('hidden');
        }

        // ë¡œì»¬ ë°ì´í„° í™•ì¸
        async function checkLocalData() {
            const investorData = JSON.parse(localStorage.getItem('investorData') || '[]');
            const accommodationData = JSON.parse(localStorage.getItem('accommodationData') || '[]');
            const reservationData = JSON.parse(localStorage.getItem('reservationData') || '[]');
            const accountingData = JSON.parse(localStorage.getItem('accountingData') || '[]');

            document.getElementById('localInvestorCount').textContent = `${investorData.length}ëª…`;
            document.getElementById('localAccommodationCount').textContent = `${accommodationData.length}ê°œ`;
            document.getElementById('localReservationCount').textContent = `${reservationData.length}ê±´`;
            document.getElementById('localAccountingCount').textContent = `${accountingData.length}ê±´`;
        }

        // Firebase ë°ì´í„° í™•ì¸
        async function checkFirebaseData() {
            try {
                if (!firebaseStorage.isConfigured()) {
                    document.getElementById('firebaseInvestorCount').textContent = 'ì„¤ì • í•„ìš”';
                    document.getElementById('firebaseAccommodationCount').textContent = 'ì„¤ì • í•„ìš”';
                    document.getElementById('firebaseReservationCount').textContent = 'ì„¤ì • í•„ìš”';
                    document.getElementById('firebaseAccountingCount').textContent = 'ì„¤ì • í•„ìš”';
                    return;
                }

                const investors = await firebaseStorage.loadInvestors();
                const accommodations = await firebaseStorage.loadAccommodations();
                const reservations = await firebaseStorage.loadReservations();
                const accounting = await firebaseStorage.loadAccounting();

                document.getElementById('firebaseInvestorCount').textContent = `${investors.length}ëª…`;
                document.getElementById('firebaseAccommodationCount').textContent = `${accommodations.length}ê°œ`;
                document.getElementById('firebaseReservationCount').textContent = `${reservations.length}ê±´`;
                document.getElementById('firebaseAccountingCount').textContent = `${accounting.length}ê±´`;

            } catch (error) {
                log('Firebase ë°ì´í„° í™•ì¸ ì¤‘ ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }

        // íˆ¬ìì ë§ˆì´ê·¸ë ˆì´ì…˜
        async function migrateInvestors() {
            if (!firebaseStorage.isConfigured()) {
                log('âŒ Firebase ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.', 'error');
                return;
            }

            const localData = JSON.parse(localStorage.getItem('investorData') || '[]');
            
            if (localData.length === 0) {
                log('ë§ˆì´ê·¸ë ˆì´ì…˜í•  íˆ¬ìì ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                return;
            }

            log(`íˆ¬ìì ${localData.length}ëª… Firebaseë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œì‘...`, 'info');

            for (const investor of localData) {
                try {
                    await firebaseStorage.saveInvestor(investor);
                    log(`âœ… íˆ¬ìì "${investor.name}" ë§ˆì´ê·¸ë ˆì´ì…˜ ì„±ê³µ`, 'success');
                } catch (error) {
                    log(`âŒ íˆ¬ìì "${investor.name}" ë§ˆì´ê·¸ë ˆì´ì…˜ ì˜¤ë¥˜: ${error.message}`, 'error');
                }
            }

            log('íˆ¬ìì ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ!', 'success');
            await checkFirebaseData();
        }

        // ìˆ™ì†Œ ë§ˆì´ê·¸ë ˆì´ì…˜
        async function migrateAccommodations() {
            if (!firebaseStorage.isConfigured()) {
                log('âŒ Firebase ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.', 'error');
                return;
            }

            const localData = JSON.parse(localStorage.getItem('accommodationData') || '[]');
            
            if (localData.length === 0) {
                log('ë§ˆì´ê·¸ë ˆì´ì…˜í•  ìˆ™ì†Œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                return;
            }

            log(`ìˆ™ì†Œ ${localData.length}ê°œ Firebaseë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œì‘...`, 'info');

            for (const accommodation of localData) {
                try {
                    await firebaseStorage.saveAccommodation(accommodation);
                    log(`âœ… ìˆ™ì†Œ "${accommodation.name}" ë§ˆì´ê·¸ë ˆì´ì…˜ ì„±ê³µ`, 'success');
                } catch (error) {
                    log(`âŒ ìˆ™ì†Œ "${accommodation.name}" ë§ˆì´ê·¸ë ˆì´ì…˜ ì˜¤ë¥˜: ${error.message}`, 'error');
                }
            }

            log('ìˆ™ì†Œ ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ!', 'success');
            await checkFirebaseData();
        }

        // ì˜ˆì•½ ë§ˆì´ê·¸ë ˆì´ì…˜
        async function migrateReservations() {
            if (!firebaseStorage.isConfigured()) {
                log('âŒ Firebase ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.', 'error');
                return;
            }

            const localData = JSON.parse(localStorage.getItem('reservationData') || '[]');
            
            if (localData.length === 0) {
                log('ë§ˆì´ê·¸ë ˆì´ì…˜í•  ì˜ˆì•½ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                return;
            }

            log(`ì˜ˆì•½ ${localData.length}ê±´ Firebaseë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œì‘...`, 'info');

            for (const reservation of localData) {
                try {
                    await firebaseStorage.saveReservation(reservation);
                    log(`âœ… ì˜ˆì•½ ë§ˆì´ê·¸ë ˆì´ì…˜ ì„±ê³µ (ID: ${reservation.id})`, 'success');
                } catch (error) {
                    log(`âŒ ì˜ˆì•½ ë§ˆì´ê·¸ë ˆì´ì…˜ ì˜¤ë¥˜: ${error.message}`, 'error');
                }
            }

            log('ì˜ˆì•½ ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ!', 'success');
            await checkFirebaseData();
        }

        // íšŒê³„ ë§ˆì´ê·¸ë ˆì´ì…˜
        async function migrateAccounting() {
            if (!firebaseStorage.isConfigured()) {
                log('âŒ Firebase ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.', 'error');
                return;
            }

            const localData = JSON.parse(localStorage.getItem('accountingData') || '[]');
            
            if (localData.length === 0) {
                log('ë§ˆì´ê·¸ë ˆì´ì…˜í•  íšŒê³„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                return;
            }

            log(`íšŒê³„ ${localData.length}ê±´ Firebaseë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œì‘...`, 'info');

            for (const accounting of localData) {
                try {
                    await firebaseStorage.saveAccounting(accounting);
                    log(`âœ… íšŒê³„ ë§ˆì´ê·¸ë ˆì´ì…˜ ì„±ê³µ (ID: ${accounting.id})`, 'success');
                } catch (error) {
                    log(`âŒ íšŒê³„ ë§ˆì´ê·¸ë ˆì´ì…˜ ì˜¤ë¥˜: ${error.message}`, 'error');
                }
            }

            log('íšŒê³„ ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ!', 'success');
            await checkFirebaseData();
        }

        // ì „ì²´ ë§ˆì´ê·¸ë ˆì´ì…˜
        async function migrateAll() {
            if (!confirm('ì „ì²´ ë°ì´í„°ë¥¼ Firebaseë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\\n\\nì´ ì‘ì—…ì€ ëª‡ ë¶„ì´ ì†Œìš”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.')) {
                return;
            }

            log('=== ğŸš€ ì „ì²´ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œì‘ ===', 'info');
            
            await migrateInvestors();
            await migrateAccommodations();
            await migrateReservations();
            await migrateAccounting();
            
            log('=== âœ… ì „ì²´ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ! ===', 'success');
            log('ì´ì œ PCì™€ ëª¨ë°”ì¼ì—ì„œ ë°ì´í„°ê°€ ì‹¤ì‹œê°„ ë™ê¸°í™”ë©ë‹ˆë‹¤! ğŸ‰', 'success');
        }

        // ë¡œê·¸ ì¶œë ¥
        function log(message, type = 'info') {
            const logContainer = document.getElementById('migrationLog');
            const timestamp = new Date().toLocaleTimeString();
            
            const colors = {
                success: 'text-green-600',
                error: 'text-red-600',
                warning: 'text-yellow-600',
                info: 'text-blue-600'
            };

            const logEntry = document.createElement('div');
            logEntry.className = `${colors[type]} mb-1`;
            logEntry.textContent = `[${timestamp}] ${message}`;
            
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // ë¡œê·¸ ì§€ìš°ê¸°
        function clearLog() {
            document.getElementById('migrationLog').innerHTML = '<div class="text-gray-500">ë§ˆì´ê·¸ë ˆì´ì…˜ ë¡œê·¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</div>';
        }
    </script>
</body>
</html>