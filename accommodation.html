<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teamk ê³µìœ ìˆ™ë°• ê´€ë¦¬ ì‹œìŠ¤í…œ - ìˆ™ì†Œê´€ë¦¬</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="js/auth.js"></script>
    <script src="js/translations.js"></script>
    <script src="js/api.js"></script>
    <script src="js/hybrid-storage.js"></script>
    <style>
        body { 
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
        }
        .tab-button {
            transition: all 0.2s ease-in-out;
        }
        .tab-button:hover {
            background-color: #f3f4f6;
        }
        .modal-overlay {
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(2px);
        }
        .modal-content {
            max-height: 90vh;
            overflow-y: auto;
        }
        /* ëª¨ë°”ì¼ ìµœì í™” */
        @media (max-width: 768px) {
            .tab-button {
                font-size: 0.75rem;
                padding: 0.5rem;
            }
            .tab-button i {
                display: none;
            }
            .modal-content {
                margin: 1rem;
                max-height: 85vh;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="container mx-auto px-2 sm:px-4 py-4 sm:py-8">
        <!-- Header -->
        <div class="mb-4 sm:mb-6">
            <div class="bg-white rounded-lg shadow-sm p-3 sm:p-4 mb-4 sm:mb-6">
                <div class="flex justify-between items-center">
                    <h1 class="text-lg sm:text-2xl font-bold text-gray-800 mb-1 sm:mb-2" data-translate="systemTitle">
                        Teamk ê³µìœ ìˆ™ë°• ê´€ë¦¬ ì‹œìŠ¤í…œ
                    </h1>
                    <div class="language-selector">
                        <select id="languageSelect" onchange="changeLanguage(this.value)" class="text-sm border border-gray-300 rounded px-2 py-1">
                            <option value="ko">í•œêµ­ì–´</option>
                            <option value="en">English</option>
                            <option value="th">à¹„à¸—à¸¢</option>
                        </select>
                    </div>
                </div>

            </div>
            
            <!-- Tab Navigation - ëª¨ë°”ì¼ ìµœì í™” -->
            <div class="bg-white rounded-lg shadow-sm mb-4 sm:mb-6">
                <div class="flex flex-wrap border-b overflow-x-auto">
                    <button onclick="window.location.href='dashboard.html'" class="tab-button px-2 sm:px-4 py-2 sm:py-3 text-xs sm:text-sm font-medium text-gray-600 hover:text-gray-800 whitespace-nowrap">
                        <i class="fas fa-tachometer-alt mr-1"></i><span class="hidden sm:inline" data-translate="dashboard">ëŒ€ì‹œë³´ë“œ</span><span class="sm:hidden" data-translate="dashboard">ëŒ€ì‹œë³´ë“œ</span>
                    </button>
                    <button class="tab-button px-2 sm:px-4 py-2 sm:py-3 text-xs sm:text-sm font-medium text-white bg-blue-600 border-b-2 border-blue-600 whitespace-nowrap">
                        <i class="fas fa-home mr-1"></i><span class="hidden sm:inline" data-translate="accommodations">ìˆ™ì†Œ ê´€ë¦¬</span><span class="sm:hidden" data-translate="accommodations">ìˆ™ì†Œê´€ë¦¬</span>
                    </button>
                    <button onclick="window.location.href='reservation.html'" class="tab-button px-2 sm:px-4 py-2 sm:py-3 text-xs sm:text-sm font-medium text-gray-600 hover:text-gray-800 whitespace-nowrap">
                        <i class="fas fa-calendar-check mr-1"></i><span class="hidden sm:inline" data-translate="reservations">ì˜ˆì•½ ê´€ë¦¬</span><span class="sm:hidden" data-translate="reservations">ì˜ˆì•½ê´€ë¦¬</span>
                    </button>
                    <button onclick="window.location.href='analytics.html'" class="tab-button px-2 sm:px-4 py-2 sm:py-3 text-xs sm:text-sm font-medium text-gray-600 hover:text-gray-800 whitespace-nowrap">
                        <i class="fas fa-chart-bar mr-1"></i><span class="hidden sm:inline" data-translate="analytics">ì§€í‘œ ê´€ë¦¬</span><span class="sm:hidden" data-translate="analytics">ì§€í‘œê´€ë¦¬</span>
                    </button>
                    <button onclick="window.location.href='accounting.html'" class="tab-button px-2 sm:px-4 py-2 sm:py-3 text-xs sm:text-sm font-medium text-gray-600 hover:text-gray-800 whitespace-nowrap">
                        <i class="fas fa-coins mr-1"></i><span class="hidden sm:inline" data-translate="accounting">ìˆ˜ìµ ê´€ë¦¬</span><span class="sm:hidden" data-translate="accounting">ìˆ˜ìµê´€ë¦¬</span>
                    </button>
                    <button onclick="window.location.href='investor.html'" class="tab-button px-2 sm:px-4 py-2 sm:py-3 text-xs sm:text-sm font-medium text-gray-600 hover:text-gray-800 whitespace-nowrap">
                        <i class="fas fa-users mr-1"></i><span class="hidden sm:inline" data-translate="investors">íˆ¬ìì ê´€ë¦¬</span><span class="sm:hidden" data-translate="investors">íˆ¬ìì</span>
                    </button>
                    <button onclick="window.location.href='settlement.html'" class="tab-button px-2 sm:px-4 py-2 sm:py-3 text-xs sm:text-sm font-medium text-gray-600 hover:text-gray-800 whitespace-nowrap">
                        <i class="fas fa-calculator mr-1"></i><span class="hidden sm:inline" data-translate="settlement">íˆ¬ìì ì •ì‚°</span><span class="sm:hidden" data-translate="settlement">ì •ì‚°</span>
                    </button>

                    <button onclick="window.location.href='backup.html'" class="tab-button px-2 sm:px-4 py-2 sm:py-3 text-xs sm:text-sm font-medium text-gray-600 hover:text-gray-800 whitespace-nowrap">
                        <i class="fas fa-download mr-1"></i><span class="hidden sm:inline" data-translate="backup">ë°±ì—…</span><span class="sm:hidden" data-translate="backup">ë°±ì—…</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- í˜ì´ì§€ í—¤ë” -->
        <div class="bg-white rounded-lg shadow-sm p-4 sm:p-6 mb-4 sm:mb-6">
            <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center">
                <div class="mb-4 sm:mb-0">
                    <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-2">
                        <i class="fas fa-home text-blue-600 mr-2"></i>
                        <span data-translate="accommodationManagement">ìˆ™ì†Œ ê´€ë¦¬</span>
                    </h2>
                    <p class="text-sm sm:text-base text-gray-600" data-translate="accommodationManagementSubtitle">íƒœêµ­ ì—ì–´ë¹„ì•¤ë¹„ ìˆ™ì†Œ í˜„í™© ë° ìš´ì˜ ê´€ë¦¬</p>
                </div>
                <button onclick="openModal('add')" class="w-full sm:w-auto bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm sm:text-base">
                    <i class="fas fa-plus mr-2"></i>
                    <span data-translate="addAccommodation">ìƒˆ ìˆ™ì†Œ ë“±ë¡</span>
                </button>
            </div>
        </div>

        <!-- ê²€ìƒ‰ -->
        <div class="bg-white rounded-lg shadow-sm p-4 mb-4 sm:mb-6">
            <div class="relative">
                <input type="text" id="searchInput" data-translate-placeholder="searchAccommodation" placeholder="ìˆ™ì†Œëª… ê²€ìƒ‰..." 
                       class="w-full border border-gray-300 rounded-md px-3 py-2 pr-10 text-sm sm:text-base"
                       onkeyup="searchAccommodations()">
                <i class="fas fa-search absolute right-3 top-3 text-gray-400"></i>
            </div>
        </div>

        <!-- ìˆ™ì†Œ ë¦¬ìŠ¤íŠ¸ -->
        <div class="bg-white rounded-lg shadow-sm mb-4 sm:mb-6">
            <div class="p-4 border-b">
                <h3 class="text-lg font-semibold text-gray-800">ìˆ™ì†Œ ëª©ë¡</h3>
            </div>
            <div id="accommodationList" class="divide-y divide-gray-200">
                <!-- ìˆ™ì†Œ ë¦¬ìŠ¤íŠ¸ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>
        </div>


    </div>

    <!-- ìˆ™ì†Œ ìƒì„¸/ìˆ˜ì • ëª¨ë‹¬ -->
    <div id="accommodationModal" class="fixed inset-0 z-50 hidden modal-overlay">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl modal-content">
                <div class="flex justify-between items-center p-4 sm:p-6 border-b">
                    <h3 id="modalTitle" class="text-lg sm:text-xl font-semibold text-gray-800">ìˆ™ì†Œ ì •ë³´</h3>
                    <div class="flex items-center gap-2">
                        <button id="editButton" onclick="toggleEditMode()" class="text-blue-600 hover:text-blue-800 text-sm sm:text-base">
                            <i class="fas fa-edit mr-1"></i>
                            <span id="editButtonText">ìˆ˜ì •</span>
                        </button>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-lg sm:text-xl"></i>
                        </button>
                    </div>
                </div>
                
                <form id="accommodationForm" class="p-4 sm:p-6 space-y-4">
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ìˆ™ì†Œëª… *</label>
                            <input type="text" id="accommodationName" required
                                   class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm sm:text-base">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ê±´ë¬¼ëª…</label>
                            <input type="text" id="buildingName"
                                   class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm sm:text-base">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ì£¼ì†Œ</label>
                        <textarea id="address" rows="2"
                                  class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm sm:text-base"></textarea>
                    </div>

                    <div class="grid grid-cols-2 sm:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ì¸µìˆ˜</label>
                            <input type="number" id="floor"
                                   class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm sm:text-base">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ë°©ë²ˆí˜¸</label>
                            <input type="text" id="roomNumber"
                                   class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm sm:text-base">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">í‚¤ ê°¯ìˆ˜</label>
                            <input type="number" id="keyCount"
                                   class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm sm:text-base">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ì£¼ì°¨ë°©ë²•</label>
                        <input type="text" id="parkingMethod" placeholder="ì˜ˆ: ë¬´ë£Œì£¼ì°¨, ìœ ë£Œì£¼ì°¨(ì‹œê°„ë‹¹ 50ë°”íŠ¸), ì£¼ì°¨ë¶ˆê°€ ë“±"
                               class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm sm:text-base">
                    </div>

                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-user mr-1"></i>íˆ¬ììëª… *
                            </label>
                            <select id="investorName" required
                                    class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm sm:text-base">
                                <option value="">íˆ¬ììë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                                <!-- íˆ¬ìì ì˜µì…˜ì€ JavaScriptë¡œ ë™ì  ìƒì„± -->
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ê³„ì•½ì¼ì</label>
                            <input type="date" id="contractDate"
                                   class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm sm:text-base">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ë³´ì¦ê¸ˆ (THB)</label>
                            <input type="number" id="deposit"
                                   class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm sm:text-base">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ì›”ì„¸ (THB)</label>
                            <input type="number" id="monthlyRent"
                                   class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm sm:text-base">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ì›”ì„¸ ì¼ì</label>
                            <input type="number" id="rentDate" min="1" max="31" placeholder="ì¼"
                                   class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm sm:text-base">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ì—ì´ì „ì‹œ ì´ë¦„</label>
                            <input type="text" id="agencyName"
                                   class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm sm:text-base">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ì—ì´ì „ì‹œ ì—°ë½ì²˜</label>
                            <input type="tel" id="agencyContact"
                                   class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm sm:text-base">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ê¸°íƒ€</label>
                        <textarea id="notes" rows="3"
                                  class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm sm:text-base"></textarea>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-external-link-alt mr-1"></i>ì›¹í˜ì´ì§€ URL
                        </label>
                        <input type="url" id="websiteUrl" placeholder="https://www.airbnb.com/rooms/..."
                               class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm sm:text-base">
                        <p class="text-xs text-gray-500 mt-1">ì—ì–´ë¹„ì•¤ë¹„, ë¶€í‚¹ë‹·ì»´ ë“± ìˆ™ì†Œ ì˜ˆì•½ í˜ì´ì§€ ë§í¬</p>
                    </div>

                    <div id="buttonGroup" class="flex flex-col sm:flex-row gap-3 pt-4 border-t">
                        <button type="submit" id="saveButton" class="flex-1 bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors text-sm sm:text-base">
                            <i class="fas fa-save mr-2"></i>
                            ì €ì¥
                        </button>
                        <button type="button" onclick="closeModal()" class="flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors text-sm sm:text-base">
                            ì·¨ì†Œ
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë¡œê·¸ì¸ í™•ì¸
        // localStorageì—ì„œ íˆ¬ìì ë°ì´í„° ë¡œë“œ
        function loadInvestorDataFromStorage() {
            const saved = localStorage.getItem('investorData');
            if (saved) {
                return JSON.parse(saved);
            }
            
            // ê¸°ë³¸ ìƒ˜í”Œ ë°ì´í„° ì œê±°ë¨ - ë¹ˆ ë°°ì—´ ë°˜í™˜
            return [];
        }

        // íˆ¬ìì ë°ì´í„° (localStorageì—ì„œ ë¡œë“œ)
        let investors = loadInvestorDataFromStorage();

        // íˆ¬ìì ì½¤ë³´ë°•ìŠ¤ ì±„ìš°ê¸°
        function populateInvestorSelect() {
            const selectElement = document.getElementById('investorName');
            
            console.log('íˆ¬ìì ì½¤ë³´ë°•ìŠ¤ ì—…ë°ì´íŠ¸ ì¤‘... íˆ¬ìì ìˆ˜:', investors.length);
            
            // ê¸°ì¡´ ì˜µì…˜ ì œê±° (ì²« ë²ˆì§¸ ê¸°ë³¸ ì˜µì…˜ ì œì™¸)
            while (selectElement.children.length > 1) {
                selectElement.removeChild(selectElement.lastChild);
            }
            
            // íˆ¬ìì ì˜µì…˜ ì¶”ê°€
            investors.forEach(investor => {
                const option = document.createElement('option');
                option.value = investor.name;
                option.textContent = `${investor.name} (${investor.email})`;
                option.dataset.investorId = investor.id;
                option.dataset.userId = investor.userId;
                selectElement.appendChild(option);
                console.log('íˆ¬ìì ì˜µì…˜ ì¶”ê°€ë¨:', investor.name);
            });
        }

        // ìˆ™ì†Œ ë°ì´í„° ë¡œë“œ í•¨ìˆ˜
        async function loadAccommodations() {
            // localStorageì—ì„œ ë°ì´í„° ë¡œë“œ
            accommodations = await loadAccommodationsFromStorage();
            
            const user = getCurrentUser();
            let filteredAccommodations = accommodations;
            
            // íˆ¬ììì¸ ê²½ìš° ìì‹ ì˜ ìˆ™ì†Œë§Œ í•„í„°ë§
            if (user.userType === 'investor') {
                filteredAccommodations = filterDataByAccess(accommodations, 'accommodationId');
            }
            
            renderAccommodationList(filteredAccommodations);
        }

        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ” accommodation.html ë¡œê·¸ì¸ í™•ì¸ ì‹œì‘');
            
            // ê°•í™”ëœ ì„¸ì…˜ ê²€ì¦
            const session = verifySession();
            if (!session) {
                console.log('âŒ ë¡œê·¸ì¸ ì •ë³´ ì—†ìŒ - index.htmlë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸');
                window.location.replace('index.html');
                return;
            }
            
            console.log('âœ… ë¡œê·¸ì¸ í™•ì¸ë¨ - í˜ì´ì§€ ì´ˆê¸°í™” ì§„í–‰');
            
            // ëª¨ë“  ë¡œê·¸ì¸ ì‚¬ìš©ì ì ‘ê·¼ í—ˆìš© (ë°ì´í„°ëŠ” ê¶Œí•œë³„ í•„í„°ë§)
            if (checkLoginStatus()) {
                initializePagePermissions(); // ê¶Œí•œë³„ í˜ì´ì§€ ì„¤ì •
                populateInvestorSelect(); // íˆ¬ìì ì½¤ë³´ë°•ìŠ¤ ì´ˆê¸°í™”
                loadAccommodations();
                
                // íˆ¬ìì ë°ì´í„° ë³€ê²½ ê°ì§€ (localStorage ë³€ê²½)
                window.addEventListener('storage', function(e) {
                    if (e.key === 'investorData') {
                        investors = loadInvestorDataFromStorage();
                        populateInvestorSelect(); // ì½¤ë³´ë°•ìŠ¤ ì—…ë°ì´íŠ¸
                    }
                });
                
                // ê°™ì€ íƒ­ ë‚´ì—ì„œì˜ íˆ¬ìì ë°ì´í„° ë³€ê²½ ê°ì§€
                window.addEventListener('investorDataUpdated', function(e) {
                    investors = e.detail.investorData;
                    populateInvestorSelect(); // ì½¤ë³´ë°•ìŠ¤ ì—…ë°ì´íŠ¸
                });
            }
        });

        // ìˆ™ì†Œ ë°ì´í„° ë¡œë“œ í•¨ìˆ˜ (í•˜ì´ë¸Œë¦¬ë“œ)
        async function loadAccommodationsFromStorage() {
            if (window.hybridStorage) {
                return await hybridStorage.load('accommodationData');
            } else {
                const saved = localStorage.getItem('accommodationData');
                return saved ? JSON.parse(saved) : [];
            }
        }
        
        // ìˆ™ì†Œ ë°ì´í„° ì €ì¥ í•¨ìˆ˜ (í•˜ì´ë¸Œë¦¬ë“œ)
        async function saveAccommodationsToStorage() {
            if (window.hybridStorage) {
                await hybridStorage.save('accommodationData', accommodations);
            } else {
                localStorage.setItem('accommodationData', JSON.stringify(accommodations));
            }
        }
        
        // ìˆ™ì†Œ ë°ì´í„° - localStorageì—ì„œ ë¡œë“œ
        let accommodations = [];

        let currentMode = 'view'; // 'view', 'edit', 'add'
        let currentId = null;
        let isEditMode = false;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìˆ™ì†Œ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§ - ë©”ì¸ DOMContentLoadedì—ì„œ ì²˜ë¦¬ë¨

        // ìˆ™ì†Œ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
        function renderAccommodationList(filteredData = accommodations) {
            const listContainer = document.getElementById('accommodationList');
            listContainer.innerHTML = '';

            // ë°ì´í„°ê°€ ë°°ì—´ì¸ì§€ í™•ì¸
            if (!Array.isArray(filteredData)) {
                console.error('filteredData is not an array:', filteredData);
                filteredData = [];
            }

            filteredData.forEach(accommodation => {
                const listItem = document.createElement('div');
                listItem.className = 'p-4 hover:bg-gray-50 cursor-pointer transition-colors';
                listItem.onclick = () => {
                    const user = getCurrentUser();
                    if (user.userType === 'investor') {
                        openModal('view', accommodation.id); // íˆ¬ììëŠ” ë³´ê¸°ë§Œ ê°€ëŠ¥
                    } else {
                        openModal('view', accommodation.id);
                    }
                };
                
                const websiteButton = accommodation.websiteUrl ? 
                    `<button onclick="event.stopPropagation(); window.open('${accommodation.websiteUrl}', '_blank')" 
                             class="text-blue-600 hover:text-blue-800 p-2 rounded-lg hover:bg-blue-50 transition-colors mr-2" 
                             title="ì›¹í˜ì´ì§€ ë°©ë¬¸">
                        <i class="fas fa-external-link-alt"></i>
                     </button>` : '';
                
                listItem.innerHTML = `
                    <div class="flex justify-between items-center">
                        <div class="flex-1">
                            <h4 class="font-semibold text-gray-900 text-sm sm:text-base">${accommodation.accommodationName}</h4>
                            <p class="text-xs sm:text-sm text-gray-500 mt-1">${accommodation.buildingName || '-'}</p>
                        </div>
                        <div class="flex items-center">
                            ${websiteButton}
                            <i class="fas fa-chevron-right text-gray-400"></i>
                        </div>
                    </div>
                `;
                
                listContainer.appendChild(listItem);
            });

            if (filteredData.length === 0) {
                listContainer.innerHTML = `
                    <div class="p-8 text-center">
                        <i class="fas fa-home text-gray-300 text-4xl mb-4"></i>
                        <h3 class="text-lg font-semibold text-gray-600 mb-2">ë“±ë¡ëœ ìˆ™ì†Œê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                        <p class="text-gray-500 text-sm mb-4">ìƒˆë¡œìš´ ìˆ™ì†Œë¥¼ ë“±ë¡í•´ë³´ì„¸ìš”.</p>
                        <button onclick="openModal('add')" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                            <i class="fas fa-plus mr-2"></i>
                            ìˆ™ì†Œ ë“±ë¡í•˜ê¸°
                        </button>
                    </div>
                `;
            }
        }

        // ê²€ìƒ‰ ê¸°ëŠ¥
        function searchAccommodations() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const filteredData = accommodations.filter(accommodation =>
                accommodation.accommodationName.toLowerCase().includes(searchTerm)
            );
            renderAccommodationList(filteredData);
        }

        // ëª¨ë‹¬ ì—´ê¸°
        function openModal(mode, id = null) {
            const user = getCurrentUser();
            
            // íˆ¬ìì ê¶Œí•œ ì²´í¬
            if (user.userType === 'investor' && mode === 'add') {
                alert('íˆ¬ììëŠ” ìƒˆ ìˆ™ì†Œë¥¼ ë“±ë¡í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            currentMode = mode;
            currentId = id;
            isEditMode = false;
            
            const modal = document.getElementById('accommodationModal');
            const title = document.getElementById('modalTitle');
            const form = document.getElementById('accommodationForm');
            const editButton = document.getElementById('editButton');
            const editButtonText = document.getElementById('editButtonText');
            
            if (mode === 'add') {
                title.textContent = 'ìƒˆ ìˆ™ì†Œ ë“±ë¡';
                form.reset();
                editButton.style.display = 'none';
                isEditMode = true;
            } else if (mode === 'view') {
                const accommodation = accommodations.find(a => a.id === id);
                if (accommodation) {
                    title.textContent = 'ìˆ™ì†Œ ì •ë³´';
                    populateForm(accommodation);
                    
                    // íˆ¬ììëŠ” í¸ì§‘ ë²„íŠ¼ ìˆ¨ê¹€
                    if (user.userType === 'investor') {
                        editButton.style.display = 'none';
                    } else {
                        editButton.style.display = 'block';
                        editButtonText.textContent = 'ìˆ˜ì •';
                    }
                    isEditMode = false;
                }
            }
            
            updateFormState();
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        // í¼ì— ë°ì´í„° ì±„ìš°ê¸°
        function populateForm(accommodation) {
            document.getElementById('accommodationName').value = accommodation.accommodationName || '';
            document.getElementById('buildingName').value = accommodation.buildingName || '';
            document.getElementById('address').value = accommodation.address || '';
            document.getElementById('floor').value = accommodation.floor || '';
            document.getElementById('roomNumber').value = accommodation.roomNumber || '';
            document.getElementById('keyCount').value = accommodation.keyCount || '';
            document.getElementById('parkingMethod').value = accommodation.parkingMethod || '';
            document.getElementById('investorName').value = accommodation.investorName || '';
            document.getElementById('contractDate').value = accommodation.contractDate || '';
            document.getElementById('deposit').value = accommodation.deposit || '';
            document.getElementById('monthlyRent').value = accommodation.monthlyRent || '';
            document.getElementById('rentDate').value = accommodation.rentDate || '';
            document.getElementById('agencyName').value = accommodation.agencyName || '';
            document.getElementById('agencyContact').value = accommodation.agencyContact || '';
            document.getElementById('notes').value = accommodation.notes || '';
            document.getElementById('websiteUrl').value = accommodation.websiteUrl || '';
        }

        // ëª¨ë‹¬ ë‹«ê¸°
        function closeModal() {
            const modal = document.getElementById('accommodationModal');
            modal.classList.add('hidden');
            document.body.style.overflow = 'auto';
            currentMode = 'view';
            currentId = null;
            isEditMode = false;
        }
        
        // ìˆ˜ì • ëª¨ë“œ í† ê¸€
        function toggleEditMode() {
            isEditMode = !isEditMode;
            const editButtonText = document.getElementById('editButtonText');
            
            if (isEditMode) {
                editButtonText.textContent = 'ì·¨ì†Œ';
            } else {
                editButtonText.textContent = 'ìˆ˜ì •';
                // ì›ë˜ ë°ì´í„°ë¡œ ë³µì›
                const accommodation = accommodations.find(a => a.id === currentId);
                if (accommodation) {
                    populateForm(accommodation);
                }
            }
            
            updateFormState();
        }
        
        // í¼ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateFormState() {
            const form = document.getElementById('accommodationForm');
            const formElements = form.querySelectorAll('input, textarea');
            const saveButton = document.getElementById('saveButton');
            
            const isReadOnly = currentMode === 'view' && !isEditMode;
            
            formElements.forEach(element => {
                element.readOnly = isReadOnly;
                if (isReadOnly) {
                    element.classList.add('bg-gray-50');
                } else {
                    element.classList.remove('bg-gray-50');
                }
            });
            
            // ì €ì¥ ë²„íŠ¼ í‘œì‹œ/ìˆ¨ê¹€
            if (currentMode === 'add' || isEditMode) {
                saveButton.style.display = 'block';
            } else {
                saveButton.style.display = 'none';
            }
        }

        // í¼ ì œì¶œ ì²˜ë¦¬
        document.getElementById('accommodationForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // íˆ¬ìì ê¶Œí•œ ì²´í¬
            const user = getCurrentUser();
            if (user.userType === 'investor') {
                alert('íˆ¬ììëŠ” ë°ì´í„°ë¥¼ ìˆ˜ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            if (currentMode === 'view' && !isEditMode) return;
            
            const accommodationData = {
                accommodationName: document.getElementById('accommodationName').value,
                buildingName: document.getElementById('buildingName').value,
                address: document.getElementById('address').value,
                floor: parseInt(document.getElementById('floor').value) || null,
                roomNumber: document.getElementById('roomNumber').value,
                keyCount: parseInt(document.getElementById('keyCount').value) || null,
                parkingMethod: document.getElementById('parkingMethod').value,
                investorName: document.getElementById('investorName').value,
                contractDate: document.getElementById('contractDate').value,
                deposit: parseInt(document.getElementById('deposit').value) || null,
                monthlyRent: parseInt(document.getElementById('monthlyRent').value) || null,
                rentDate: parseInt(document.getElementById('rentDate').value) || null,
                agencyName: document.getElementById('agencyName').value,
                agencyContact: document.getElementById('agencyContact').value,
                notes: document.getElementById('notes').value,
                websiteUrl: document.getElementById('websiteUrl').value
            };
            
            if (currentMode === 'add') {
                accommodationData.id = Date.now(); // ê³ ìœ  ID ìƒì„±
                accommodations.push(accommodationData);
                saveAccommodationsToStorage(); // localStorageì— ì €ì¥
                alert('ìˆ™ì†Œê°€ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } else if (isEditMode) {
                const index = accommodations.findIndex(a => a.id === currentId);
                if (index !== -1) {
                    accommodations[index] = { ...accommodations[index], ...accommodationData };
                    saveAccommodationsToStorage(); // localStorageì— ì €ì¥
                    alert('ìˆ™ì†Œ ì •ë³´ê°€ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
                }
                // ìˆ˜ì • ë§ˆì³¤ í›„ ì½ê¸° ëª¨ë“œë¡œ ì „í™˜
                isEditMode = false;
                document.getElementById('editButtonText').textContent = 'ìˆ˜ì •';
                updateFormState();
            }
            
            renderAccommodationList();
            
            if (currentMode === 'add') {
                closeModal();
            }
        });

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        document.getElementById('accommodationModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });


    </script>
</body>
</html>