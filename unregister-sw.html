<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Service Worker 제거</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50 p-8">
    <div class="max-w-2xl mx-auto">
        <div class="bg-white rounded-lg shadow p-6">
            <h1 class="text-2xl font-bold mb-4">Service Worker 제거 도구</h1>
            <p class="text-gray-600 mb-6">Service Worker 관련 오류를 해결하기 위해 등록된 모든 Service Worker를 제거합니다.</p>
            
            <div id="status" class="mb-4 p-4 bg-blue-50 border border-blue-200 rounded">
                <p class="text-blue-800">Service Worker 상태를 확인 중...</p>
            </div>
            
            <button onclick="unregisterServiceWorkers()" class="bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg mr-4">
                Service Worker 제거
            </button>
            
            <button onclick="clearCache()" class="bg-orange-600 hover:bg-orange-700 text-white px-6 py-3 rounded-lg">
                캐시 삭제
            </button>
            
            <div id="results" class="mt-6 space-y-2">
                <!-- 결과가 여기에 표시됩니다 -->
            </div>
        </div>
    </div>

    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const colors = {
                'info': 'bg-blue-50 border-blue-200 text-blue-800',
                'success': 'bg-green-50 border-green-200 text-green-800',
                'error': 'bg-red-50 border-red-200 text-red-800',
                'warning': 'bg-yellow-50 border-yellow-200 text-yellow-800'
            };
            
            const div = document.createElement('div');
            div.className = `p-3 border rounded ${colors[type]}`;
            div.textContent = message;
            results.appendChild(div);
        }

        async function checkServiceWorkerStatus() {
            const status = document.getElementById('status');
            
            if ('serviceWorker' in navigator) {
                try {
                    const registrations = await navigator.serviceWorker.getRegistrations();
                    if (registrations.length > 0) {
                        status.innerHTML = `
                            <p class="text-yellow-800">⚠️ ${registrations.length}개의 Service Worker가 등록되어 있습니다.</p>
                            <p class="text-sm text-yellow-600 mt-1">이것이 오류의 원인일 수 있습니다.</p>
                        `;
                        status.className = 'mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded';
                    } else {
                        status.innerHTML = '<p class="text-green-800">✅ 등록된 Service Worker가 없습니다.</p>';
                        status.className = 'mb-4 p-4 bg-green-50 border border-green-200 rounded';
                    }
                } catch (error) {
                    status.innerHTML = `<p class="text-red-800">❌ Service Worker 상태 확인 실패: ${error.message}</p>`;
                    status.className = 'mb-4 p-4 bg-red-50 border border-red-200 rounded';
                }
            } else {
                status.innerHTML = '<p class="text-gray-800">Service Worker가 지원되지 않는 브라우저입니다.</p>';
                status.className = 'mb-4 p-4 bg-gray-50 border border-gray-200 rounded';
            }
        }

        async function unregisterServiceWorkers() {
            log('Service Worker 제거를 시작합니다...', 'info');
            
            if ('serviceWorker' in navigator) {
                try {
                    const registrations = await navigator.serviceWorker.getRegistrations();
                    
                    if (registrations.length === 0) {
                        log('제거할 Service Worker가 없습니다.', 'info');
                        return;
                    }
                    
                    for (let registration of registrations) {
                        try {
                            await registration.unregister();
                            log(`✅ Service Worker 제거 성공: ${registration.scope}`, 'success');
                        } catch (error) {
                            log(`❌ Service Worker 제거 실패: ${error.message}`, 'error');
                        }
                    }
                    
                    log(`총 ${registrations.length}개의 Service Worker 제거 완료`, 'success');
                    
                    // 상태 다시 확인
                    setTimeout(checkServiceWorkerStatus, 1000);
                    
                } catch (error) {
                    log(`Service Worker 제거 중 오류: ${error.message}`, 'error');
                }
            } else {
                log('이 브라우저는 Service Worker를 지원하지 않습니다.', 'warning');
            }
        }

        async function clearCache() {
            log('캐시 삭제를 시작합니다...', 'info');
            
            if ('caches' in window) {
                try {
                    const cacheNames = await caches.keys();
                    
                    if (cacheNames.length === 0) {
                        log('삭제할 캐시가 없습니다.', 'info');
                        return;
                    }
                    
                    for (let cacheName of cacheNames) {
                        try {
                            await caches.delete(cacheName);
                            log(`✅ 캐시 삭제 성공: ${cacheName}`, 'success');
                        } catch (error) {
                            log(`❌ 캐시 삭제 실패: ${cacheName} - ${error.message}`, 'error');
                        }
                    }
                    
                    log(`총 ${cacheNames.length}개의 캐시 삭제 완료`, 'success');
                    
                } catch (error) {
                    log(`캐시 삭제 중 오류: ${error.message}`, 'error');
                }
            } else {
                log('이 브라우저는 Cache API를 지원하지 않습니다.', 'warning');
            }
            
            // 브라우저 캐시도 제안
            log('브라우저를 새로고침(Ctrl+F5 또는 Cmd+Shift+R)하여 완전히 캐시를 지워주세요.', 'info');
        }

        // 페이지 로드 시 상태 확인
        document.addEventListener('DOMContentLoaded', function() {
            checkServiceWorkerStatus();
        });
    </script>
</body>
</html>