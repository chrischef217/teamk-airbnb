<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë°ì´í„° ë¡œë”© ë””ë²„ê¹…</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .section h3 {
            color: #333;
            margin-top: 0;
        }
        .btn {
            display: inline-block;
            padding: 10px 20px;
            margin: 5px;
            background: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            border: none;
            cursor: pointer;
        }
        .btn-success { background: #28a745; }
        .btn-warning { background: #ffc107; color: #000; }
        .btn-danger { background: #dc3545; }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .status.info { background: #d1ecf1; color: #0c5460; }
        .highlight { background: yellow; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ë°ì´í„° ë¡œë”© ë””ë²„ê¹… ë„êµ¬</h1>
        <p>í˜„ì¬ ì‹œìŠ¤í…œì˜ ë°ì´í„° ì €ì¥ ìƒíƒœì™€ ë¡œë”© ê³¼ì •ì„ ë¶„ì„í•©ë‹ˆë‹¤.</p>
        
        <div style="text-align: center; margin: 20px 0;">
            <button class="btn btn-success" onclick="checkAllData()">ğŸ” ì „ì²´ ë°ì´í„° ê²€ì‚¬</button>
            <button class="btn" onclick="testDataLoading()">ğŸ§ª ë°ì´í„° ë¡œë”© í…ŒìŠ¤íŠ¸</button>
            <button class="btn btn-warning" onclick="showFirebaseStatus()">ğŸ”¥ Firebase ìƒíƒœ í™•ì¸</button>
            <button class="btn btn-danger" onclick="clearAndReload()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
        </div>
        
        <div id="results"></div>
        
        <div style="text-align: center; margin: 30px 0;">
            <a href="accommodation.html" class="btn">ğŸ  ìˆ™ì†Œê´€ë¦¬</a>
            <a href="accounting.html" class="btn">ğŸ’° ìˆ˜ìµê´€ë¦¬</a>
            <a href="investor.html" class="btn">ğŸ‘¥ íˆ¬ìê´€ë¦¬</a>
            <a href="dashboard.html" class="btn">ğŸ“Š ëŒ€ì‹œë³´ë“œ</a>
            <a href="index.html" class="btn">ğŸ  ë©”ì¸</a>
        </div>
    </div>

    <!-- Firebase ì„¤ì • ë¡œë“œ -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="js/firebase-config.js"></script>
    <script src="js/firebase-storage.js"></script>

    <script>
        function checkAllData() {
            const results = document.getElementById('results');
            let html = '<div class="section"><h3>ğŸ“Š ì „ì²´ ë°ì´í„° ê²€ì‚¬ ê²°ê³¼</h3>';
            
            try {
                // localStorage ë°ì´í„° í™•ì¸
                const accommodationData = JSON.parse(localStorage.getItem('accommodationData') || '[]');
                const investorData = JSON.parse(localStorage.getItem('investorData') || '[]');
                const accountingData = JSON.parse(localStorage.getItem('accountingData') || '[]');
                
                html += '<h4>ğŸ’¾ localStorage ë°ì´í„°:</h4>';
                html += `<div class="status info">
                    ìˆ™ì†Œ: ${accommodationData.length}ê°œ |
                    íˆ¬ìì: ${investorData.length}ëª… |
                    íšŒê³„: ${accountingData.length}ê±´
                </div>`;
                
                // ìˆ™ì†Œ ë°ì´í„° ìƒì„¸ í‘œì‹œ
                html += '<h5>ğŸ  ìˆ™ì†Œ ë°ì´í„°:</h5><pre>';
                if (accommodationData.length === 0) {
                    html += '<span class="highlight">âš ï¸ ìˆ™ì†Œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤!</span>';
                } else {
                    accommodationData.forEach((item, index) => {
                        html += `${index + 1}. ID: ${item.id}\n`;
                        html += `   ì´ë¦„: ${item.accommodationName || item.name || 'ì´ë¦„ì—†ìŒ'}\n`;
                        html += `   íˆ¬ìê¸ˆ: ${item.totalInvestment || item.investment || 0} THB\n`;
                        html += `   íˆ¬ìì: ${item.investorName || 'íˆ¬ììì—†ìŒ'}\n`;
                        html += `   ìœ„ì¹˜: ${item.location || 'ìœ„ì¹˜ì—†ìŒ'}\n`;
                        html += `   ì„ëŒ€ë£Œ: ${item.monthlyRent || item.rent || 0} THB\n\n`;
                    });
                }
                html += '</pre>';
                
                // íˆ¬ìì ë°ì´í„° ìƒì„¸ í‘œì‹œ
                html += '<h5>ğŸ‘¥ íˆ¬ìì ë°ì´í„°:</h5><pre>';
                if (investorData.length === 0) {
                    html += '<span class="highlight">âš ï¸ íˆ¬ìì ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤!</span>';
                } else {
                    investorData.forEach((item, index) => {
                        html += `${index + 1}. ID: ${item.id}\n`;
                        html += `   ì´ë¦„: ${item.name || 'ì´ë¦„ì—†ìŒ'}\n`;
                        html += `   ì´ë©”ì¼: ${item.email || 'ì´ë©”ì¼ì—†ìŒ'}\n`;
                        html += `   íˆ¬ìë¹„ìœ¨: ${item.investorRatio || 0}%\n\n`;
                    });
                }
                html += '</pre>';
                
                // íšŒê³„ ë°ì´í„° ìƒì„¸ í‘œì‹œ (ìµœê·¼ 10ê°œë§Œ)
                html += '<h5>ğŸ’° íšŒê³„ ë°ì´í„° (ìµœê·¼ 10ê°œ):</h5><pre>';
                if (accountingData.length === 0) {
                    html += '<span class="highlight">âš ï¸ íšŒê³„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤!</span>';
                } else {
                    const recentAccounting = accountingData.slice(-10);
                    recentAccounting.forEach((item, index) => {
                        html += `${index + 1}. ìˆ™ì†ŒID: ${item.accommodationId}\n`;
                        html += `   ìˆ™ì†Œëª…: ${item.accommodationName || 'ìˆ™ì†Œëª…ì—†ìŒ'}\n`;
                        html += `   íƒ€ì…: ${item.type} (${item.category || 'ì¹´í…Œê³ ë¦¬ì—†ìŒ'})\n`;
                        html += `   ê¸ˆì•¡: ${item.amount || 0} THB\n`;
                        html += `   ë‚ ì§œ: ${item.date || item.transactionDate || 'ë‚ ì§œì—†ìŒ'}\n`;
                        html += `   ì„¤ëª…: ${item.description || 'ì„¤ëª…ì—†ìŒ'}\n\n`;
                    });
                    if (accountingData.length > 10) {
                        html += `... ì´ ${accountingData.length}ê±´ ì¤‘ ìµœê·¼ 10ê±´ë§Œ í‘œì‹œ\n`;
                    }
                }
                html += '</pre>';
                
                html += '</div>';
                
                results.innerHTML = html;
                
            } catch (error) {
                results.innerHTML = `<div class="status error">âŒ ë°ì´í„° ê²€ì‚¬ ì¤‘ ì˜¤ë¥˜: ${error.message}</div>`;
            }
        }
        
        async function testDataLoading() {
            const results = document.getElementById('results');
            let html = '<div class="section"><h3>ğŸ§ª ë°ì´í„° ë¡œë”© í…ŒìŠ¤íŠ¸</h3>';
            
            try {
                html += '<h4>1ï¸âƒ£ Firebase ì—°ê²° í…ŒìŠ¤íŠ¸:</h4>';
                
                if (typeof firebaseStorage !== 'undefined' && firebaseStorage.isConfigured()) {
                    html += '<div class="status success">âœ… Firebase ì„¤ì • ì™„ë£Œ</div>';
                    
                    // Firebaseì—ì„œ ë°ì´í„° ë¡œë“œ ì‹œë„
                    try {
                        html += '<h4>2ï¸âƒ£ Firebase ë°ì´í„° ë¡œë“œ í…ŒìŠ¤íŠ¸:</h4>';
                        
                        const fbAccommodations = await firebaseStorage.loadAccommodations();
                        const fbInvestors = await firebaseStorage.loadInvestors();
                        const fbAccounting = await firebaseStorage.loadAccounting();
                        
                        html += `<div class="status info">
                            Firebase ë°ì´í„°:<br>
                            â€¢ ìˆ™ì†Œ: ${fbAccommodations.length}ê°œ<br>
                            â€¢ íˆ¬ìì: ${fbInvestors.length}ëª…<br>
                            â€¢ íšŒê³„: ${fbAccounting.length}ê±´
                        </div>`;
                        
                        if (fbAccommodations.length > 0 || fbInvestors.length > 0 || fbAccounting.length > 0) {
                            html += '<div class="status success">âœ… Firebaseì—ì„œ ì‹¤ì œ ë°ì´í„° ë°œê²¬!</div>';
                            
                            // Firebase ë°ì´í„°ë¥¼ localStorageì— ë™ê¸°í™”
                            if (fbAccommodations.length > 0) {
                                localStorage.setItem('accommodationData', JSON.stringify(fbAccommodations));
                            }
                            if (fbInvestors.length > 0) {
                                localStorage.setItem('investorData', JSON.stringify(fbInvestors));
                            }
                            if (fbAccounting.length > 0) {
                                localStorage.setItem('accountingData', JSON.stringify(fbAccounting));
                            }
                            
                            html += '<div class="status success">âœ… localStorageì— Firebase ë°ì´í„° ë™ê¸°í™” ì™„ë£Œ</div>';
                        } else {
                            html += '<div class="status error">âš ï¸ Firebaseì— ì‹¤ì œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
                        }
                        
                    } catch (fbError) {
                        html += `<div class="status error">âŒ Firebase ë¡œë“œ ì‹¤íŒ¨: ${fbError.message}</div>`;
                    }
                    
                } else {
                    html += '<div class="status error">âŒ Firebase ì„¤ì •ì´ ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤</div>';
                    html += '<div class="status info">ğŸ’¡ localStorage ë°ì´í„°ë§Œ ì‚¬ìš©í•©ë‹ˆë‹¤</div>';
                }
                
                html += '<h4>3ï¸âƒ£ ë°ì´í„° ë¡œë”© ì‹œë®¬ë ˆì´ì…˜:</h4>';
                
                // ëŒ€ì‹œë³´ë“œ ìŠ¤íƒ€ì¼ ë°ì´í„° ë¡œë”© ì‹œë®¬ë ˆì´ì…˜
                const accommodations = JSON.parse(localStorage.getItem('accommodationData') || '[]');
                const investors = JSON.parse(localStorage.getItem('investorData') || '[]');
                const accountingData = JSON.parse(localStorage.getItem('accountingData') || '[]');
                
                html += `<div class="status info">
                    ë¡œë”©ëœ ë°ì´í„°:<br>
                    â€¢ ìˆ™ì†Œ: ${accommodations.length}ê°œ<br>
                    â€¢ íˆ¬ìì: ${investors.length}ëª…<br>
                    â€¢ íšŒê³„: ${accountingData.length}ê±´
                </div>`;
                
                if (accommodations.length === 0 && investors.length === 0 && accountingData.length === 0) {
                    html += '<div class="status error">âš ï¸ ëª¨ë“  ë°ì´í„°ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤!</div>';
                    html += '<div class="status info">ğŸ’¡ ë¨¼ì € ìˆ™ì†Œê´€ë¦¬, ìˆ˜ìµê´€ë¦¬, íˆ¬ìê´€ë¦¬ì—ì„œ ë°ì´í„°ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>';
                } else {
                    html += '<div class="status success">âœ… ì‹¤ì œ ë°ì´í„°ê°€ ìˆìŠµë‹ˆë‹¤!</div>';
                }
                
                html += '</div>';
                results.innerHTML = html;
                
            } catch (error) {
                results.innerHTML = `<div class="status error">âŒ í…ŒìŠ¤íŠ¸ ì¤‘ ì˜¤ë¥˜: ${error.message}</div>`;
            }
        }
        
        function showFirebaseStatus() {
            const results = document.getElementById('results');
            let html = '<div class="section"><h3>ğŸ”¥ Firebase ì—°ê²° ìƒíƒœ</h3>';
            
            if (typeof firebase !== 'undefined' && typeof firebaseStorage !== 'undefined') {
                html += '<div class="status success">âœ… Firebase SDK ë¡œë“œë¨</div>';
                
                if (firebaseStorage.isConfigured()) {
                    html += '<div class="status success">âœ… Firebase ì„¤ì • ì™„ë£Œ</div>';
                    html += '<div class="status info">Firebaseë¥¼ í†µí•´ ì‹¤ì‹œê°„ ë°ì´í„° ë™ê¸°í™”ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.</div>';
                } else {
                    html += '<div class="status error">âŒ Firebase ì„¤ì •ì´ ì™„ë£Œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤</div>';
                    html += '<div class="status info">ğŸ’¡ firebase-setup.htmlì—ì„œ ì„¤ì •ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”.</div>';
                }
            } else {
                html += '<div class="status error">âŒ Firebase SDKê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤</div>';
                html += '<div class="status info">ğŸ’¡ ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•˜ê³  í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.</div>';
            }
            
            html += '</div>';
            results.innerHTML = html;
        }
        
        function clearAndReload() {
            window.location.reload();
        }
        
        // í˜ì´ì§€ ë¡œë“œì‹œ ìë™ ì‹¤í–‰
        window.addEventListener('load', () => {
            checkAllData();
        });
    </script>
</body>
</html>