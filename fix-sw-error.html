<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Service Worker 오류 해결 가이드</title>
    <!-- Service Worker 완전 차단 (최우선 로드) -->
    <script src="js/super-block-sw.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
</head>
<body class="bg-gray-50">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- 헤더 -->
        <div class="bg-white rounded-lg shadow-sm p-6 mb-8">
            <div class="flex items-center mb-4">
                <i class="fas fa-tools text-blue-600 text-3xl mr-4"></i>
                <div>
                    <h1 class="text-3xl font-bold text-gray-800">Service Worker 오류 해결</h1>
                    <p class="text-gray-600">workbox 관련 오류를 해결하는 완전한 가이드</p>
                </div>
            </div>
        </div>

        <!-- 자동 해결 -->
        <div class="bg-green-50 border border-green-200 rounded-lg p-6 mb-8">
            <h2 class="text-xl font-bold text-green-800 mb-4">
                <i class="fas fa-magic mr-2"></i>
                자동 해결 (권장)
            </h2>
            <p class="text-green-700 mb-4">아래 버튼을 클릭하여 자동으로 Service Worker를 제거합니다:</p>
            <button onclick="autoFix()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg mb-4">
                <i class="fas fa-wand-magic-sparkles mr-2"></i>
                자동 해결 실행
            </button>
            <div id="autoFixResult" class="hidden mt-4"></div>
        </div>

        <!-- 수동 해결 방법들 -->
        <div class="grid md:grid-cols-2 gap-6 mb-8">
            <!-- Chrome 해결 방법 -->
            <div class="bg-white rounded-lg shadow-sm p-6">
                <h3 class="text-lg font-bold text-gray-800 mb-4">
                    <i class="fab fa-chrome text-blue-600 mr-2"></i>
                    Chrome 해결 방법
                </h3>
                <ol class="space-y-2 text-sm text-gray-700">
                    <li><strong>1.</strong> F12를 눌러 개발자 도구 열기</li>
                    <li><strong>2.</strong> Application 탭 클릭</li>
                    <li><strong>3.</strong> 왼쪽 메뉴에서 "Service workers" 클릭</li>
                    <li><strong>4.</strong> 등록된 모든 Service Worker에서 "Unregister" 클릭</li>
                    <li><strong>5.</strong> "Storage" → "Clear storage" 클릭</li>
                    <li><strong>6.</strong> 페이지 새로고침 (Ctrl+F5)</li>
                </ol>
            </div>

            <!-- Firefox 해결 방법 -->
            <div class="bg-white rounded-lg shadow-sm p-6">
                <h3 class="text-lg font-bold text-gray-800 mb-4">
                    <i class="fab fa-firefox text-orange-600 mr-2"></i>
                    Firefox 해결 방법
                </h3>
                <ol class="space-y-2 text-sm text-gray-700">
                    <li><strong>1.</strong> F12를 눌러 개발자 도구 열기</li>
                    <li><strong>2.</strong> Application 탭 (또는 Storage 탭) 클릭</li>
                    <li><strong>3.</strong> "Service Workers" 섹션 찾기</li>
                    <li><strong>4.</strong> 등록된 Service Worker "Unregister" 클릭</li>
                    <li><strong>5.</strong> 브라우저 캐시 삭제 (Ctrl+Shift+Del)</li>
                    <li><strong>6.</strong> 페이지 새로고침 (Ctrl+F5)</li>
                </ol>
            </div>
        </div>

        <!-- 고급 해결 방법 -->
        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-6 mb-8">
            <h3 class="text-lg font-bold text-yellow-800 mb-4">
                <i class="fas fa-cog mr-2"></i>
                고급 해결 방법
            </h3>
            <div class="space-y-4 text-yellow-800">
                <div>
                    <h4 class="font-semibold">브라우저 완전 리셋:</h4>
                    <p class="text-sm">Chrome: 설정 → 고급 → 재설정 및 정리 → 설정을 원래 기본값으로 복원</p>
                </div>
                <div>
                    <h4 class="font-semibold">시크릿/프라이빗 모드 테스트:</h4>
                    <p class="text-sm">새 시크릿/프라이빗 창에서 사이트를 열어 오류가 여전히 발생하는지 확인</p>
                </div>
                <div>
                    <h4 class="font-semibold">다른 브라우저 테스트:</h4>
                    <p class="text-sm">Safari, Edge 등 다른 브라우저에서 사이트가 정상 작동하는지 확인</p>
                </div>
            </div>
        </div>

        <!-- 오류 정보 -->
        <div class="bg-red-50 border border-red-200 rounded-lg p-6 mb-8">
            <h3 class="text-lg font-bold text-red-800 mb-4">
                <i class="fas fa-info-circle mr-2"></i>
                오류 상세 정보
            </h3>
            <div class="text-red-700 text-sm">
                <p class="mb-2"><strong>오류 메시지:</strong> <code>non-precached-url</code></p>
                <p class="mb-2"><strong>원인:</strong> 이전에 PWA로 설정된 웹사이트의 Service Worker가 남아있어 발생</p>
                <p class="mb-2"><strong>영향:</strong> 웹사이트 기능에는 영향 없음 (콘솔 오류만 표시)</p>
                <p><strong>해결:</strong> Service Worker와 캐시를 완전히 제거하면 해결됨</p>
            </div>
        </div>

        <!-- 상태 확인 -->
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
            <h3 class="text-lg font-bold text-blue-800 mb-4">
                <i class="fas fa-chart-line mr-2"></i>
                현재 상태 확인
            </h3>
            <div id="statusCheck" class="text-blue-700">
                <p>상태를 확인하는 중...</p>
            </div>
            <button onclick="checkStatus()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded mt-4">
                상태 다시 확인
            </button>
        </div>
    </div>

    <script>
        async function autoFix() {
            const resultDiv = document.getElementById('autoFixResult');
            resultDiv.classList.remove('hidden');
            resultDiv.innerHTML = '<p class="text-green-600">자동 해결을 실행하는 중...</p>';
            
            let messages = [];
            
            // Service Worker 제거
            if ('serviceWorker' in navigator) {
                try {
                    const registrations = await navigator.serviceWorker.getRegistrations();
                    if (registrations.length > 0) {
                        for (let registration of registrations) {
                            await registration.unregister();
                        }
                        messages.push(`✅ ${registrations.length}개 Service Worker 제거 완료`);
                    } else {
                        messages.push('✅ 제거할 Service Worker 없음');
                    }
                } catch (error) {
                    messages.push(`❌ Service Worker 제거 실패: ${error.message}`);
                }
            }
            
            // 캐시 제거
            if ('caches' in window) {
                try {
                    const cacheNames = await caches.keys();
                    if (cacheNames.length > 0) {
                        for (let cacheName of cacheNames) {
                            await caches.delete(cacheName);
                        }
                        messages.push(`✅ ${cacheNames.length}개 캐시 삭제 완료`);
                    } else {
                        messages.push('✅ 삭제할 캐시 없음');
                    }
                } catch (error) {
                    messages.push(`❌ 캐시 삭제 실패: ${error.message}`);
                }
            }
            
            resultDiv.innerHTML = `
                <div class="bg-green-100 border border-green-300 rounded p-3">
                    <h4 class="font-bold text-green-800 mb-2">자동 해결 완료!</h4>
                    <ul class="text-green-700 text-sm space-y-1">
                        ${messages.map(msg => `<li>${msg}</li>`).join('')}
                    </ul>
                    <p class="text-green-600 text-sm mt-2">페이지를 새로고침(F5)해주세요.</p>
                </div>
            `;
            
            setTimeout(() => {
                window.location.reload();
            }, 3000);
        }
        
        async function checkStatus() {
            const statusDiv = document.getElementById('statusCheck');
            statusDiv.innerHTML = '<p class="text-blue-600">상태를 확인하는 중...</p>';
            
            let status = [];
            
            // Service Worker 상태
            if ('serviceWorker' in navigator) {
                try {
                    const registrations = await navigator.serviceWorker.getRegistrations();
                    if (registrations.length > 0) {
                        status.push(`⚠️ ${registrations.length}개의 Service Worker가 등록되어 있음`);
                    } else {
                        status.push('✅ Service Worker 없음');
                    }
                } catch (error) {
                    status.push('❌ Service Worker 상태 확인 실패');
                }
            } else {
                status.push('ℹ️ Service Worker 미지원 브라우저');
            }
            
            // 캐시 상태
            if ('caches' in window) {
                try {
                    const cacheNames = await caches.keys();
                    if (cacheNames.length > 0) {
                        status.push(`⚠️ ${cacheNames.length}개의 캐시가 저장되어 있음`);
                    } else {
                        status.push('✅ 저장된 캐시 없음');
                    }
                } catch (error) {
                    status.push('❌ 캐시 상태 확인 실패');
                }
            } else {
                status.push('ℹ️ Cache API 미지원 브라우저');
            }
            
            statusDiv.innerHTML = `
                <ul class="text-blue-700 space-y-1">
                    ${status.map(s => `<li>${s}</li>`).join('')}
                </ul>
            `;
        }
        
        // 페이지 로드시 상태 확인
        document.addEventListener('DOMContentLoaded', function() {
            checkStatus();
        });
    </script>
</body>
</html>