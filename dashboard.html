<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teamk íƒœêµ­ ì—ì–´ë¹„ì•¤ë¹„ ìˆ™ë°•ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <!-- SUPER SERVICE WORKER BLOCKER (100% ì™„ì „ ì°¨ë‹¨) -->
    <script src="js/super-block-sw.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/translations.js"></script>

    <script src="js/firebase-storage.js"></script>
    <style>
        body { 
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
        }
        .kpi-card {
            border-radius: 8px;
            position: relative;
            overflow: hidden;
        }
        .tab-button {
            transition: all 0.2s ease-in-out;
        }
        .tab-button:hover {
            background-color: #f3f4f6;
        }
        .property-card {
            transition: box-shadow 0.2s ease-in-out;
        }
        .property-card:hover {
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="container mx-auto px-2 sm:px-4 py-4 sm:py-8">
        <!-- Header -->
        <div class="mb-6">
            <div class="bg-white rounded-lg shadow-sm p-4 mb-6">
                <h1 class="text-2xl font-bold text-gray-800 mb-2" data-translate="systemTitle">
                    Teamk íƒœêµ­ ì—ì–´ë¹„ì•¤ë¹„ ìˆ™ë°•ê´€ë¦¬ ì‹œìŠ¤í…œ
                </h1>

            </div>
            
            <!-- Tab Navigation -->
            <div class="bg-white rounded-lg shadow-sm mb-6">
                <div class="flex flex-wrap border-b">
                    <button class="px-4 py-3 text-sm font-medium text-white bg-blue-600 border-b-2 border-blue-600 rounded-tl-lg">
                        <i class="fas fa-tachometer-alt mr-1"></i> <span data-translate="dashboard">ëŒ€ì‹œë³´ë“œ</span>
                    </button>
                    <button onclick="window.location.href='accommodation.html'" class="px-4 py-3 text-sm font-medium text-gray-600 hover:text-gray-800">
                        <i class="fas fa-home mr-1"></i> <span data-translate="accommodations">ìˆ™ì†Œ ê´€ë¦¬</span>
                    </button>
                    <button onclick="window.location.href='reservation.html'" class="px-4 py-3 text-sm font-medium text-gray-600 hover:text-gray-800">
                        <i class="fas fa-calendar-check mr-1"></i> <span data-translate="reservations">ì˜ˆì•½ ê´€ë¦¬</span>
                    </button>

                    <button onclick="window.location.href='accounting.html'" class="px-4 py-3 text-sm font-medium text-gray-600 hover:text-gray-800">
                        <i class="fas fa-coins mr-1"></i> <span data-translate="accounting">ìˆ˜ìµ ê´€ë¦¬</span>
                    </button>
                    <button onclick="window.location.href='investor.html'" class="px-4 py-3 text-sm font-medium text-gray-600 hover:text-gray-800">
                        <i class="fas fa-users mr-1"></i> <span data-translate="investors">íˆ¬ìì ê´€ë¦¬</span>
                    </button>
                    <button onclick="window.location.href='settlement.html'" class="px-4 py-3 text-sm font-medium text-gray-600 hover:text-gray-800">
                        <i class="fas fa-calculator mr-1"></i> <span data-translate="settlement">íˆ¬ìì ì •ì‚°</span>
                    </button>

                    <button onclick="window.location.href='data-migration.html'" class="px-4 py-3 text-sm font-medium text-gray-600 hover:text-gray-800">
                        <i class="fas fa-database mr-1"></i> ë°ì´í„° ê´€ë¦¬
                    </button>
                </div>
            </div>
        </div>

        <!-- Key Metrics Summary -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 mb-6 sm:mb-8">
            <!-- ì´ ìˆ™ì†Œ ìˆ˜ ì¹´ë“œ -->
            <div class="bg-gradient-to-r from-purple-400 to-purple-500 rounded-lg p-6 text-white relative overflow-hidden">
                <div class="relative z-10">
                    <h3 class="text-sm font-medium opacity-90 mb-2">ì´ ìˆ™ì†Œ ìˆ˜</h3>
                    <p class="text-3xl font-bold mb-1" data-kpi="total-properties">0ê°œ</p>
                </div>
                <div class="absolute top-4 right-4 text-4xl opacity-30">
                    <i class="fas fa-home"></i>
                </div>
            </div>
            
            <!-- ì´ íˆ¬ìê¸ˆ ì¹´ë“œ -->
            <div class="bg-gradient-to-r from-indigo-400 to-indigo-500 rounded-lg p-6 text-white relative overflow-hidden">
                <div class="relative z-10">
                    <h3 class="text-sm font-medium opacity-90 mb-2">ì´ íˆ¬ìê¸ˆ</h3>
                    <p class="text-3xl font-bold mb-1" data-kpi="total-investment">0 THB</p>
                </div>
                <div class="absolute top-4 right-4 text-4xl opacity-30">
                    <i class="fas fa-piggy-bank"></i>
                </div>
            </div>
            
            <!-- ì´ ìˆ˜ìµ ì¹´ë“œ -->
            <div class="bg-gradient-to-r from-pink-400 to-pink-500 rounded-lg p-6 text-white relative overflow-hidden">
                <div class="relative z-10">
                    <h3 class="text-sm font-medium opacity-90 mb-2">ì´ ìˆ˜ìµ</h3>
                    <p class="text-3xl font-bold mb-1" data-kpi="total-revenue">0 THB</p>
                </div>
                <div class="absolute top-4 right-4 text-4xl opacity-30">
                    <i class="fas fa-coins"></i>
                </div>
            </div>
            
            <!-- ì´ ìˆœìˆ˜ìµ ì¹´ë“œ -->
            <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg p-6 text-white relative overflow-hidden">
                <div class="relative z-10">
                    <h3 class="text-sm font-medium opacity-90 mb-2">ì´ ìˆœìˆ˜ìµ</h3>
                    <p class="text-3xl font-bold mb-1" data-kpi="net-profit">0 THB</p>
                </div>
                <div class="absolute top-4 right-4 text-4xl opacity-30">
                    <i class="fas fa-chart-line-up"></i>
                </div>
            </div>
            

            
            <!-- ì ìœ ìœ¨ ì¹´ë“œ -->
            <div class="bg-gradient-to-r from-orange-400 to-orange-500 rounded-lg p-6 text-white relative overflow-hidden">
                <div class="relative z-10">
                    <h3 class="text-sm font-medium opacity-90 mb-2">ì ìœ ìœ¨</h3>
                    <p class="text-3xl font-bold mb-1" data-kpi="occupancy-rate">0%</p>
                </div>
                <div class="absolute top-4 right-4 text-4xl opacity-30">
                    <i class="fas fa-calendar-check"></i>
                </div>
            </div>
        </div>



        <!-- ìƒì„¸ ë°ì´í„° í…Œì´ë¸” -->
        <div class="bg-white rounded-lg shadow-sm overflow-hidden mb-8">
            <div class="bg-gray-50 px-6 py-4 border-b">
                <h3 class="text-lg font-semibold text-gray-800">
                    ìƒì„¸ ìˆ™ì†Œë³„ ìˆ˜ìµ ë°ì´í„°
                </h3>
            </div>
            
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ìˆ™ì†Œëª…</th>
                            <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">íˆ¬ìê¸ˆ</th>
                            <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">ëˆ„ì  ìˆ˜ìµê¸ˆ</th>
                            <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">ëˆ„ì  ì§€ì¶œê¸ˆ</th>
                            <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">ëˆ„ì  ìˆœìˆ˜ìµ</th>
    
                        </tr>
                    </thead>
                    <tbody id="dataTable" class="bg-white divide-y divide-gray-200">
                        <!-- Table data will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™” - ë‹¨ìˆœí•˜ê³  í™•ì‹¤í•œ ë°©ë²•
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ ëŒ€ì‹œë³´ë“œ í˜ì´ì§€ ì´ˆê¸°í™” ì‹œì‘');
            
            // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ (ê´€ë¦¬ì ì „ìš©)
            if (!checkLoginStatus()) {
                return;
            }
            
            // 1ì´ˆ í›„ ì‹¤í–‰í•˜ì—¬ ëª¨ë“  DOMì´ ì¤€ë¹„ë˜ë„ë¡ í•¨
            setTimeout(async () => {
                try {
                    console.log('ğŸ“‚ ë°ì´í„° ë¡œë”© ì‹œì‘...');
                    
                    // localStorageì—ì„œ ì§ì ‘ ë°ì´í„° ë¡œë“œ
                    const localInvestors = localStorage.getItem('investorData');
                    const localAccommodations = localStorage.getItem('accommodationData');
                    const localAccounting = localStorage.getItem('accountingData');
                    
                    investors = localInvestors ? JSON.parse(localInvestors) : [];
                    accommodations = localAccommodations ? JSON.parse(localAccommodations) : [];
                    accountingData = localAccounting ? JSON.parse(localAccounting) : [];
                    
                    console.log('ğŸ“Š ë¡œë“œëœ ë°ì´í„°:', {
                        investors: investors.length,
                        accommodations: accommodations.length,
                        accounting: accountingData.length
                    });
                    
                    // ì‹¤ì œ ë°ì´í„°ë§Œ ì‚¬ìš© - ê°€ì§œ ë°ì´í„° ìƒì„±í•˜ì§€ ì•ŠìŒ
                    if (accommodations.length === 0) {
                        console.log('âš ï¸ ìˆ™ì†Œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ìˆ™ì†Œê´€ë¦¬ì—ì„œ ë°ì´í„°ë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    }
                    if (accountingData.length === 0) {
                        console.log('âš ï¸ íšŒê³„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ìˆ˜ìµê´€ë¦¬ì—ì„œ ë°ì´í„°ë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    }
                    
                    // ì‹¤ì œ ê³„ì‚° ë° ì—…ë°ì´íŠ¸
                    console.log('ğŸ§® ë°ì´í„° ê³„ì‚° ì‹œì‘...');
                    const realData = calculateRealData();
                    
                    console.log('ğŸ“Š KPI ì—…ë°ì´íŠ¸ ì‹œì‘...');
                    updateKPICards(realData);
                    
                    console.log('ğŸ“‹ í…Œì´ë¸” ì—…ë°ì´íŠ¸ ì‹œì‘...');
                    updateDataTable(realData);
                    
                    console.log('ğŸ‰ ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™” ì™„ë£Œ!');
                    
                } catch (error) {
                    console.error('âŒ ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                    alert('ëŒ€ì‹œë³´ë“œ ë¡œë”© ì‹¤íŒ¨: ' + error.message);
                }
            }, 1000);
        });
        
        // ë¡œê·¸ì¸ ì²´í¬ëŠ” auth.jsì—ì„œ ì²˜ë¦¬
        
        // ê¸€ë¡œë²Œ ë°ì´í„° ë³€ìˆ˜
        let investors = [];
        let accommodations = [];
        let accountingData = [];

        // ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™” í•¨ìˆ˜
        async function initializeDashboard() {
            console.log('ğŸ“Š ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë“œ ì‹œì‘');
            
            try {
                // ê°„ë‹¨í•˜ê²Œ localStorageì—ì„œ ì§ì ‘ ë¡œë“œ
                await loadSystemDataSimple();
                
                // ì‹¤ì œ ë°ì´í„° ê¸°ë°˜ ê³„ì‚°
                const realData = calculateRealData();
                
                // KPI ì¹´ë“œ ì—…ë°ì´íŠ¸
                updateKPICards(realData);
                
                // ë°ì´í„° í…Œì´ë¸” ì—…ë°ì´íŠ¸
                updateDataTable(realData);
                
                console.log('âœ… ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë“œ ì™„ë£Œ');
                
            } catch (error) {
                console.error('âŒ ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                console.log('âš ï¸ ë”ë¯¸ ë°ì´í„° ìƒì„±í•˜ì§€ ì•ŠìŒ - ì‹¤ì œ ë°ì´í„°ë§Œ ì‚¬ìš©');
                
                // ë¹ˆ ë°ì´í„°ë¡œ í™”ë©´ í‘œì‹œ
                const emptyData = {
                    properties: [],
                    kpis: {
                        totalProperties: 0,
                        totalInvestment: 0,
                        totalRevenue: 0,
                        totalExpense: 0,
                        netProfit: 0,
                        occupancyRate: 0
                    }
                };
                updateKPICards(emptyData);
                updateDataTable(emptyData);
            }
        }

        // ê°„ë‹¨í•œ ë°ì´í„° ë¡œë”© (localStorage ìš°ì„ )
        async function loadSystemDataSimple() {
            console.log('ğŸ“‚ localStorageì—ì„œ ë°ì´í„° ë¡œë“œ ì¤‘...');
            
            // localStorageì—ì„œ ì§ì ‘ ë¡œë“œ
            const localInvestors = localStorage.getItem('investorData');
            const localAccommodations = localStorage.getItem('accommodationData');
            const localAccounting = localStorage.getItem('accountingData');
            
            investors = localInvestors ? JSON.parse(localInvestors) : [];
            accommodations = localAccommodations ? JSON.parse(localAccommodations) : [];
            accountingData = localAccounting ? JSON.parse(localAccounting) : [];
            
            console.log('ğŸ“Š ë¡œë“œëœ ë°ì´í„°:', {
                investors: investors.length + 'ëª…',
                accommodations: accommodations.length + 'ê°œ',
                accounting: accountingData.length + 'ê±´'
            });
            
            // ì‹¤ì œ ë°ì´í„°ë§Œ ì‚¬ìš© - ë”ë¯¸ ë°ì´í„° ìƒì„±í•˜ì§€ ì•ŠìŒ
            if (investors.length === 0 && accommodations.length === 0) {
                console.log('âš ï¸ ì‹¤ì œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
            }
        }

        // ì‹¤ì œ ì‹œìŠ¤í…œ ë°ì´í„° ë¡œë“œ (Firebase í¬í•¨)
        async function loadSystemData() {
            try {
                // Firebaseì—ì„œ ë°ì´í„° ë¡œë“œ ì‹œë„
                if (typeof firebaseStorage !== 'undefined' && firebaseStorage.isConnected()) {
                    console.log('ğŸ”¥ Firebaseì—ì„œ ë°ì´í„° ë¡œë“œ ì¤‘...');
                    const [investorData, accommodationData, accountingDataResult] = await Promise.all([
                        firebaseStorage.loadInvestors(),
                        firebaseStorage.loadAccommodations(),
                        firebaseStorage.loadAccounting()
                    ]);
                    
                    investors = investorData || [];
                    accommodations = accommodationData || [];
                    accountingData = accountingDataResult || [];
                    
                    console.log('âœ… Firebase ë°ì´í„° ë¡œë“œ:', investors.length + 'ëª… íˆ¬ìì, ' + accommodations.length + 'ê°œ ìˆ™ì†Œ, ' + accountingData.length + 'ê±´ íšŒê³„');
                } else {
                    throw new Error('Firebase ì—°ê²° ì—†ìŒ');
                }
            } catch (firebaseError) {
                console.log('âš ï¸ Firebase ë¡œë“œ ì‹¤íŒ¨, localStorage í´ë°±:', firebaseError.message);
                
                // localStorage í´ë°±
                const localInvestors = localStorage.getItem('investorData');
                const localAccommodations = localStorage.getItem('accommodationData');
                const localAccounting = localStorage.getItem('accountingData');
                
                investors = localInvestors ? JSON.parse(localInvestors) : [];
                accommodations = localAccommodations ? JSON.parse(localAccommodations) : [];
                accountingData = localAccounting ? JSON.parse(localAccounting) : [];
                
                // ì‹¤ì œ ë°ì´í„°ë§Œ ì‚¬ìš© - ë”ë¯¸ ë°ì´í„° ìƒì„±í•˜ì§€ ì•ŠìŒ
                if (investors.length === 0 && accommodations.length === 0) {
                    console.log('âš ï¸ ì‹¤ì œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ìˆ™ì†Œê´€ë¦¬ì™€ ìˆ˜ìµê´€ë¦¬ì—ì„œ ë°ì´í„°ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                }
                
                console.log('âœ… localStorage ë°ì´í„° ë¡œë“œ:', investors.length + 'ëª… íˆ¬ìì, ' + accommodations.length + 'ê°œ ìˆ™ì†Œ, ' + accountingData.length + 'ê±´ íšŒê³„');
            }
        }



        // ì‹¤ì œ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì •í™•í•˜ê²Œ ê³„ì‚°
        function calculateRealData() {
            console.log('ğŸ§® ì‹¤ì œ ë°ì´í„° ê¸°ë°˜ ê³„ì‚° ì‹œì‘');
            console.log('ğŸ“Š ì…ë ¥ ë°ì´í„°:', {
                accommodations: accommodations.length,
                accountingData: accountingData.length,
                investors: investors.length
            });
            
            const properties = [];
            let totalInvestment = 0;
            let totalRevenue = 0;
            let totalExpense = 0;
            
            // ê° ìˆ™ì†Œë³„ ë°ì´í„° ê³„ì‚°
            accommodations.forEach((acc, index) => {
                console.log(`ğŸ  ìˆ™ì†Œ ${index + 1} ê³„ì‚°:`, acc.accommodationName || acc.name);
                
                // í•´ë‹¹ ìˆ™ì†Œì˜ íšŒê³„ ë°ì´í„° í•„í„°ë§ - ë‹¤ì–‘í•œ ID í˜•íƒœ ì²˜ë¦¬
                const accAccountingData = accountingData.filter(item => {
                    const itemAccId = parseInt(item.accommodationId) || parseInt(item.accommodation_id) || 0;
                    const accId = parseInt(acc.id) || 0;
                    return itemAccId === accId;
                });
                
                console.log(`ğŸ’° ìˆ™ì†Œ ${acc.accommodationName || acc.name}ì˜ íšŒê³„ ë°ì´í„°:`, accAccountingData.length + 'ê±´');
                
                // íˆ¬ìê¸ˆ - ë‹¤ì–‘í•œ í•„ë“œëª… ì²˜ë¦¬
                const investment = parseFloat(
                    acc.totalInvestment || 
                    acc.investment || 
                    acc.total_investment || 
                    acc.investmentAmount || 
                    0
                );
                
                // ìˆ˜ìµ ê³„ì‚° - income íƒ€ì… í•­ëª©ë“¤
                const revenue = accAccountingData
                    .filter(item => (item.type || '').toLowerCase() === 'income')
                    .reduce((sum, item) => {
                        const amount = parseFloat(item.amount || 0);
                        console.log(`  ğŸ“ˆ ìˆ˜ìµ: ${amount} (${item.description || 'ì„¤ëª…ì—†ìŒ'})`);
                        return sum + amount;
                    }, 0);
                    
                // ì§€ì¶œ ê³„ì‚° - expense íƒ€ì… í•­ëª©ë“¤  
                const expense = accAccountingData
                    .filter(item => (item.type || '').toLowerCase() === 'expense')
                    .reduce((sum, item) => {
                        const amount = parseFloat(item.amount || 0);
                        console.log(`  ğŸ“‰ ì§€ì¶œ: ${amount} (${item.description || 'ì„¤ëª…ì—†ìŒ'})`);
                        return sum + amount;
                    }, 0);
                
                const netProfit = revenue - expense;
                
                // íˆ¬ììëª… ì°¾ê¸° - ë‹¤ì–‘í•œ í•„ë“œëª… ì²˜ë¦¬
                const investorName = acc.investorName || acc.investor_name || acc.owner || 'ë¯¸ì§€ì •';
                
                console.log(`ğŸ“Š ìˆ™ì†Œ ${acc.accommodationName || acc.name} ê³„ì‚° ê²°ê³¼:`, {
                    investment: investment,
                    revenue: revenue,
                    expense: expense,
                    netProfit: netProfit
                });
                
                properties.push({
                    name: acc.accommodationName || acc.name || `ìˆ™ì†Œ ${acc.id}`,
                    investment: investment,
                    totalRevenue: revenue,
                    totalExpense: expense,
                    netProfit: netProfit,
                    investorName: investorName
                });
                
                // ì „ì²´ í•©ê³„ì— ì¶”ê°€
                totalInvestment += investment;
                totalRevenue += revenue;
                totalExpense += expense;
            });
            
            const totalNetProfit = totalRevenue - totalExpense;
            
            // ì ìœ ìœ¨ ê³„ì‚° (ìˆ˜ìµì´ ìˆëŠ” ìˆ™ì†Œ / ì „ì²´ ìˆ™ì†Œ)
            const activeProperties = properties.filter(prop => prop.totalRevenue > 0).length;
            const occupancyRate = accommodations.length > 0 ? (activeProperties / accommodations.length) * 100 : 0;
            
            const result = {
                properties: properties,
                kpis: {
                    totalProperties: accommodations.length,
                    totalInvestment: totalInvestment,
                    totalRevenue: totalRevenue,
                    totalExpense: totalExpense,
                    netProfit: totalNetProfit,
                    occupancyRate: occupancyRate
                }
            };
            
            console.log('ğŸ¯ ìµœì¢… KPI ê³„ì‚° ê²°ê³¼:', result.kpis);
            return result;
        }

        // ë°ì´í„° ì—†ìŒ ë©”ì‹œì§€ í‘œì‹œ
        function showNoDataMessage() {
            const container = document.querySelector('.container');
            if (container) {
                container.innerHTML = `
                    <div class="text-center py-12">
                        <i class="fas fa-exclamation-triangle text-yellow-500 text-6xl mb-4"></i>
                        <h2 class="text-2xl font-bold text-gray-800 mb-2">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</h2>
                        <p class="text-gray-600 mb-4">Firebase ì—°ë™ì„ ë¨¼ì € ì„¤ì •í•˜ê±°ë‚˜, íˆ¬ìì ë° ìˆ™ì†Œ ë°ì´í„°ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
                        <div class="space-x-2">
                            <a href="firebase-setup.html" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">
                                Firebase ì—°ë™ ì„¤ì •
                            </a>
                            <a href="investor.html" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600">
                                íˆ¬ìì ê´€ë¦¬
                            </a>
                        </div>
                    </div>
                `;
            }
        }
        
        // KPI ì¹´ë“œ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateKPICards(data) {
            console.log('ğŸ“Š KPI ì¹´ë“œ ì—…ë°ì´íŠ¸ ì‹œì‘');
            console.log('ğŸ“‹ ì—…ë°ì´íŠ¸í•  ë°ì´í„°:', data.kpis);
            
            const kpiElements = {
                totalProperties: document.querySelector('[data-kpi="total-properties"]'),
                totalInvestment: document.querySelector('[data-kpi="total-investment"]'),
                totalRevenue: document.querySelector('[data-kpi="total-revenue"]'),
                netProfit: document.querySelector('[data-kpi="net-profit"]'),
    
                occupancyRate: document.querySelector('[data-kpi="occupancy-rate"]')
            };
            
            // ê° ìš”ì†Œ ì¡´ì¬ ì—¬ë¶€ í™•ì¸
            Object.keys(kpiElements).forEach(key => {
                if (!kpiElements[key]) {
                    console.warn(`âš ï¸ KPI ìš”ì†Œ ì°¾ì„ ìˆ˜ ì—†ìŒ: ${key}`);
                }
            });
            
            // ê° KPI ì¹´ë“œ ì—…ë°ì´íŠ¸ - ì•ˆì „í•œ ì—…ë°ì´íŠ¸
            try {
                if (kpiElements.totalProperties) {
                    kpiElements.totalProperties.textContent = data.kpis.totalProperties + 'ê°œ';
                    console.log('âœ… ì´ ìˆ™ì†Œ ìˆ˜ ì—…ë°ì´íŠ¸:', data.kpis.totalProperties + 'ê°œ');
                }
                
                if (kpiElements.totalInvestment) {
                    kpiElements.totalInvestment.textContent = data.kpis.totalInvestment.toLocaleString() + ' THB';
                    console.log('âœ… ì´ íˆ¬ìê¸ˆ ì—…ë°ì´íŠ¸:', data.kpis.totalInvestment.toLocaleString() + ' THB');
                }
                
                if (kpiElements.totalRevenue) {
                    kpiElements.totalRevenue.textContent = data.kpis.totalRevenue.toLocaleString() + ' THB';
                    console.log('âœ… ì´ ìˆ˜ìµ ì—…ë°ì´íŠ¸:', data.kpis.totalRevenue.toLocaleString() + ' THB');
                }
                
                if (kpiElements.netProfit) {
                    const netProfitText = data.kpis.netProfit.toLocaleString() + ' THB';
                    kpiElements.netProfit.textContent = netProfitText;
                    // ìˆ˜ìµ/ì†ì‹¤ì— ë”°ë¥¸ ìƒ‰ìƒ ë³€ê²½
                    if (data.kpis.netProfit >= 0) {
                        kpiElements.netProfit.parentElement.parentElement.className = 
                            kpiElements.netProfit.parentElement.parentElement.className.replace(/from-\w+-\d+ to-\w+-\d+/, 'from-green-400 to-green-500');
                    } else {
                        kpiElements.netProfit.parentElement.parentElement.className = 
                            kpiElements.netProfit.parentElement.parentElement.className.replace(/from-\w+-\d+ to-\w+-\d+/, 'from-red-400 to-red-500');
                    }
                    console.log('âœ… ìˆœìˆ˜ìµ ì—…ë°ì´íŠ¸:', netProfitText);
                }
                

                
                if (kpiElements.occupancyRate) {
                    const occupancyText = data.kpis.occupancyRate.toFixed(1) + '%';
                    kpiElements.occupancyRate.textContent = occupancyText;
                    console.log('âœ… ì ìœ ìœ¨ ì—…ë°ì´íŠ¸:', occupancyText);
                }
                
                console.log('ğŸ‰ ëª¨ë“  KPI ì¹´ë“œ ì—…ë°ì´íŠ¸ ì™„ë£Œ!');
                
            } catch (error) {
                console.error('âŒ KPI ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜:', error);
            }
        }
        
        // ë°ì´í„° í…Œì´ë¸” ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateDataTable(data) {
            console.log('ğŸ“‹ ë°ì´í„° í…Œì´ë¸” ì—…ë°ì´íŠ¸ ì‹œì‘');
            console.log('ğŸ“Š í…Œì´ë¸” ë°ì´í„°:', data.properties);
            
            const tableBody = document.getElementById('dataTable');
            if (!tableBody) {
                console.error('âŒ dataTable ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                return;
            }
            
            // ê¸°ì¡´ ë°ì´í„° ì œê±°
            tableBody.innerHTML = '';
            
            if (data.properties.length === 0) {
                // ë°ì´í„°ê°€ ì—†ì„ ë•Œ ë©”ì‹œì§€ í‘œì‹œ
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td colspan="7" class="px-4 py-8 text-center text-gray-500">
                        <div class="flex flex-col items-center">
                            <i class="fas fa-inbox text-4xl mb-2"></i>
                            <p>í‘œì‹œí•  ìˆ™ì†Œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                            <p class="text-sm">íˆ¬ìì ê´€ë¦¬ ë˜ëŠ” ìˆ™ì†Œ ê´€ë¦¬ì—ì„œ ë°ì´í„°ë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”.</p>
                        </div>
                    </td>
                `;
                tableBody.appendChild(tr);
                console.log('ğŸ“‹ ë¹ˆ í…Œì´ë¸” ë©”ì‹œì§€ í‘œì‹œ');
                return;
            }
            
            // ìƒˆ ë°ì´í„° ì¶”ê°€
            data.properties.forEach((property, index) => {
                const tr = document.createElement('tr');
                tr.className = 'hover:bg-gray-50';
                

                // ìˆœìˆ˜ìµì— ë”°ë¥¸ ìƒ‰ìƒ ê²°ì •
                const netProfitColorClass = property.netProfit >= 0 ? 'text-green-600' : 'text-red-600';
                
                tr.innerHTML = `
                    <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900">
                        ${property.name}
                    </td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-right text-gray-900 font-mono">
                        ${property.investment.toLocaleString()} THB
                    </td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-right text-green-600 font-mono">
                        ${property.totalRevenue.toLocaleString()} THB
                    </td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-right text-red-600 font-mono">
                        ${property.totalExpense.toLocaleString()} THB
                    </td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-right ${netProfitColorClass} font-mono font-semibold">
                        ${property.netProfit.toLocaleString()} THB
                    </td>

                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
                        ${property.investorName}
                    </td>
                `;
                
                tableBody.appendChild(tr);
                console.log(`âœ… í–‰ ${index + 1} ì¶”ê°€: ${property.name} (íˆ¬ìê¸ˆ: ${property.investment.toLocaleString()}, ìˆœìˆ˜ìµ: ${property.netProfit.toLocaleString()})`);
            });
            
            console.log('ğŸ‰ ë°ì´í„° í…Œì´ë¸” ì—…ë°ì´íŠ¸ ì™„ë£Œ! ì´ ' + data.properties.length + 'ê°œ í–‰');
        }

        // Populate table - ë” ì´ìƒ ì‚¬ìš©ë˜ì§€ ì•ŠìŒ (ìƒˆë¡œìš´ updateDataTable í•¨ìˆ˜ë¡œ ëŒ€ì²´)
        // const tableBody = document.getElementById('dataTable');
        /*
        tableData.forEach(row => {
            const tr = document.createElement('tr');
            tr.className = 'hover:bg-gray-50';
            
            row.forEach((cell, index) => {
                const td = document.createElement('td');
                td.className = 'px-4 py-3 whitespace-nowrap text-sm';
                
                if (index === 0) {
                    // ìˆ™ì†Œëª…
                    td.className += ' font-medium text-gray-900';
                    td.textContent = cell;
                } else if (index >= 1 && index <= 4) {
                    // íˆ¬ìê¸ˆ, ëˆ„ì  ìˆ˜ìµê¸ˆ, ëˆ„ì  ì§€ì¶œê¸ˆ, ëˆ„ì  ìˆœìˆ˜ìµ
                    td.className += ' text-right text-gray-900 font-mono';
                    td.textContent = cell + ' THB';

                }
                
                tr.appendChild(td);
            });
            
            tableBody.appendChild(tr);
        });
        */
    </script>
</body>
</html>